<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Details - Learning Management System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
        }
        
        .course-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .page-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
        }
        
        .breadcrumb-nav {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .breadcrumb-nav .breadcrumb {
            margin: 0;
        }
        
        .breadcrumb-nav .breadcrumb-item a {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
        }
        
        .breadcrumb-nav .breadcrumb-item a:hover {
            text-decoration: underline;
        }
        
        .course-info-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .course-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #007bff;
        }
        
        .stat-card .stat-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
        }
        
        .stat-card .stat-icon i {
            color: white;
            font-size: 20px;
        }
        
        .stat-card .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .stat-card .stat-label {
            color: #6c757d;
            font-weight: 500;
        }
        
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .section-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid #007bff;
        }
        
        .section-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        
        .section-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .btn-action {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-view {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .btn-add {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .btn-view:hover {
            background: #bbdefb;
        }
        
        .btn-add:hover {
            background: #c8e6c9;
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .back-btn:hover {
            background: #5a6268;
            color: white;
            transform: translateX(-2px);
        }
        
        /* Modal Styles */
        .modal-content {
            border-radius: 15px;
            border: none;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        
        .btn-close-white {
            filter: brightness(0) invert(1);
        }
    </style>
</head>
<body>
    <div class="course-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="mb-2">
                <i class="fas fa-graduation-cap me-3"></i>
                <span id="pageTitle">Course Details</span>
            </h1>
            <p class="mb-0 opacity-75" id="pageSubtitle">Manage course sections and materials</p>
        </div>

        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb-nav">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb" id="breadcrumb">
                    <li class="breadcrumb-item"><a href="Material.html">All Courses</a></li>
                    <li class="breadcrumb-item active">Course Details</li>
                </ol>
            </nav>
        </div>

        <!-- Back Button -->
        <a href="Material.html" class="back-btn mb-4">
            <i class="fas fa-arrow-left"></i>
            Back to All Courses
        </a>

        <!-- Course Information Card -->
        <div class="course-info-card">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h2 class="text-primary mb-2" id="courseTitle">Course Title</h2>
                    <p class="text-muted mb-3" id="courseDescription">Course description and details</p>
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Course Code:</strong> <span id="courseCode">-</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Instructor:</strong> <span id="courseInstructor">-</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#editCourseModal">
                        <i class="fas fa-edit me-2"></i>
                        Edit Course
                    </button>
                </div>
            </div>
        </div>

        <!-- Course Statistics -->
        <div class="course-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-list"></i>
                </div>
                <div class="stat-number" id="totalSections">0</div>
                <div class="stat-label">Total Sections</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-number" id="totalMaterials">0</div>
                <div class="stat-label">Total Materials</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" id="enrolledStudents">45</div>
                <div class="stat-label">Enrolled Students</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-number" id="completionRate">78%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
        </div>

        <!-- Course Sections -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-primary">
                <i class="fas fa-folder-open me-2"></i>
                Course Sections
            </h3>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSectionModal">
                <i class="fas fa-plus me-2"></i>
                Add New Section
            </button>
        </div>

        <div class="sections-grid" id="sectionsGrid">
            <!-- Sections will be loaded here -->
        </div>
    </div>

    <!-- Add Section Modal -->
    <div class="modal fade" id="addSectionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus me-2"></i>
                        Add New Section
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addSectionForm">
                        <div class="mb-3">
                            <label for="sectionName" class="form-label">Section Name</label>
                            <input type="text" class="form-control" id="sectionName" placeholder="e.g., Introduction, Chapter 1" required>
                        </div>
                        <div class="mb-3">
                            <label for="sectionDesc" class="form-label">Description</label>
                            <textarea class="form-control" id="sectionDesc" rows="3" placeholder="Brief description of this section..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="sectionOrder" class="form-label">Order</label>
                            <input type="number" class="form-control" id="sectionOrder" min="1" value="1">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addSection()">
                        <i class="fas fa-save me-2"></i>Add Section
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Course Modal -->
    <div class="modal fade" id="editCourseModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>
                        Edit Course Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editCourseForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editCourseName" class="form-label">Course Name</label>
                                <input type="text" class="form-control" id="editCourseName" placeholder="Enter course name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editCourseCode" class="form-label">Course Code</label>
                                <input type="text" class="form-control" id="editCourseCode" placeholder="e.g., CS101" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editCourseDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editCourseDescription" rows="3" placeholder="Course description..." required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editCourseInstructor" class="form-label">Instructor</label>
                                <input type="text" class="form-control" id="editCourseInstructor" placeholder="Instructor name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editCourseStatus" class="form-label">Course Status</label>
                                <select class="form-select" id="editCourseStatus" required>
                                    <option value="active">Active</option>
                                    <option value="draft">Draft</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="editCourseDuration" class="form-label">Duration (weeks)</label>
                                <input type="number" class="form-control" id="editCourseDuration" min="1" max="52" placeholder="12">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editCourseCredits" class="form-label">Credits</label>
                                <input type="number" class="form-control" id="editCourseCredits" min="1" max="10" placeholder="3">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editCourseLevel" class="form-label">Level</label>
                                <select class="form-select" id="editCourseLevel">
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editCoursePrerequisites" class="form-label">Prerequisites</label>
                            <textarea class="form-control" id="editCoursePrerequisites" rows="2" placeholder="List any course prerequisites..."></textarea>
                        </div>
                        <input type="hidden" id="editCourseId">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateCourse()">
                        <i class="fas fa-save me-2"></i>Update Course
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Sample Data (same as in Material.html)
        const courses = [
            {
                id: 1,
                code: 'CS101',
                name: 'Introduction to Computer Science',
                description: 'Basic concepts of programming and computer science fundamentals',
                instructor: 'Dr. Kwame Asante',
                sections: 8,
                materials: 24
            },
            {
                id: 2,
                code: 'MATH201',
                name: 'Calculus II',
                description: 'Advanced calculus including integration techniques and applications',
                instructor: 'Prof. Ama Osei',
                sections: 12,
                materials: 18
            },
            {
                id: 3,
                code: 'EDU301',
                name: 'Educational Psychology',
                description: 'Psychological principles applied to educational settings',
                instructor: 'Dr. Kofi Mensah',
                sections: 6,
                materials: 15
            },
            {
                id: 4,
                code: 'BUS205',
                name: 'Business Ethics',
                description: 'Ethical decision-making in business contexts',
                instructor: 'Mrs. Akosua Darko',
                sections: 4,
                materials: 12
            }
        ];

        const courseSections = {
            1: [
                { id: 1, name: 'Introduction to Programming', description: 'Basic programming concepts and syntax', materials: 6 },
                { id: 2, name: 'Data Types and Variables', description: 'Understanding different data types and variable declarations', materials: 4 },
                { id: 3, name: 'Control Structures', description: 'Loops, conditionals, and decision-making structures', materials: 5 },
                { id: 4, name: 'Functions and Methods', description: 'Creating reusable code blocks and procedures', materials: 3 },
                { id: 5, name: 'Object-Oriented Programming', description: 'Classes, objects, inheritance, and polymorphism', materials: 6 }
            ],
            2: [
                { id: 6, name: 'Integration Techniques', description: 'Various methods of integration including substitution and parts', materials: 5 },
                { id: 7, name: 'Applications of Integration', description: 'Real-world applications in physics and engineering', materials: 4 },
                { id: 8, name: 'Differential Equations', description: 'Solving first and second-order differential equations', materials: 5 },
                { id: 9, name: 'Series and Sequences', description: 'Infinite series, convergence, and divergence tests', materials: 4 }
            ],
            3: [
                { id: 10, name: 'Learning Theories', description: 'Major psychological theories of learning and development', materials: 4 },
                { id: 11, name: 'Cognitive Development', description: 'Piaget, Vygotsky, and modern cognitive theories', materials: 3 },
                { id: 12, name: 'Motivation and Engagement', description: 'Student motivation strategies and engagement techniques', materials: 4 },
                { id: 13, name: 'Assessment Methods', description: 'Psychological principles in educational assessment', materials: 4 }
            ],
            4: [
                { id: 14, name: 'Ethical Frameworks', description: 'Major ethical theories applied to business contexts', materials: 3 },
                { id: 15, name: 'Corporate Social Responsibility', description: 'Business obligations to society and stakeholders', materials: 3 },
                { id: 16, name: 'Decision-Making Models', description: 'Ethical decision-making processes and frameworks', materials: 3 },
                { id: 17, name: 'Case Studies', description: 'Real-world business ethics scenarios and analysis', materials: 3 }
            ]
        };

        let currentCourse = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadCourseDetails();
            
            // Add event listener for Edit Course modal
            const editCourseModal = document.getElementById('editCourseModal');
            editCourseModal.addEventListener('show.bs.modal', function() {
                populateEditCourseForm();
            });
        });

        // Load course details from URL parameters
        function loadCourseDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const courseId = urlParams.get('courseId');
            
            if (courseId) {
                // Try to get course from sessionStorage first
                const storedCourse = sessionStorage.getItem('selectedCourse');
                if (storedCourse) {
                    const course = JSON.parse(storedCourse);
                    displayCourseDetails(course);
                } else {
                    // Fallback: find course by ID
                    const course = courses.find(c => c.id == courseId);
                    if (course) {
                        displayCourseDetails(course);
                    } else {
                        // Course not found, redirect to main page
                        window.location.href = 'Material.html';
                    }
                }
            } else {
                // No course ID, redirect to main page
                window.location.href = 'Material.html';
            }
        }

        // Display course details
        function displayCourseDetails(course) {
            currentCourse = course;
            
            // Update page title and header
            document.title = `${course.name} - Course Details`;
            document.getElementById('pageTitle').textContent = course.name;
            document.getElementById('pageSubtitle').textContent = `${course.code} - Manage sections and materials`;
            
            // Update breadcrumb
            document.getElementById('breadcrumb').innerHTML = `
                <li class="breadcrumb-item"><a href="Material.html">All Courses</a></li>
                <li class="breadcrumb-item active">${course.name}</li>
            `;
            
            // Update course information
            document.getElementById('courseTitle').textContent = course.name;
            document.getElementById('courseDescription').textContent = course.description;
            document.getElementById('courseCode').textContent = course.code;
            document.getElementById('courseInstructor').textContent = course.instructor;
            document.getElementById('totalSections').textContent = course.sections;
            document.getElementById('totalMaterials').textContent = course.materials;
            
            // Load sections
            loadCourseSections(course.id);
        }

        // Load course sections
        function loadCourseSections(courseId) {
            const sectionsGrid = document.getElementById('sectionsGrid');
            sectionsGrid.innerHTML = '';
            
            const sections = courseSections[courseId] || [];
            
            if (sections.length === 0) {
                sectionsGrid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No sections found</h5>
                        <p class="text-muted">Click "Add New Section" to create the first section for this course.</p>
                    </div>
                `;
                return;
            }
            
            sections.forEach(section => {
                const sectionCard = document.createElement('div');
                sectionCard.className = 'section-card';
                
                sectionCard.innerHTML = `
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div>
                            <h6 class="mb-1">${section.name}</h6>
                            <small class="text-muted">${section.materials} materials</small>
                        </div>
                    </div>
                    <p class="text-muted small mb-3">${section.description}</p>
                    <div class="section-actions">
                        <button class="btn-action btn-view" onclick="viewMaterials(${section.id}, '${section.name}')">
                            <i class="fas fa-eye me-1"></i>View Materials
                        </button>
                        <button class="btn-action btn-add" onclick="manageMaterials(${section.id}, '${section.name}')">
                            <i class="fas fa-plus me-1"></i>Manage Materials
                        </button>
                    </div>
                `;
                
                sectionsGrid.appendChild(sectionCard);
            });
        }

        // Navigate to material management for a section
        function viewMaterials(sectionId, sectionName) {
            window.location.href = `MaterialManagement.html?courseId=${currentCourse.id}&sectionId=${sectionId}&courseName=${encodeURIComponent(currentCourse.name)}&sectionName=${encodeURIComponent(sectionName)}`;
        }

        function manageMaterials(sectionId, sectionName) {
            // Store section data for the materials page
            sessionStorage.setItem('selectedSection', JSON.stringify({
                id: sectionId,
                name: sectionName,
                courseId: currentCourse.id,
                courseName: currentCourse.name
            }));
            
            window.location.href = `MaterialManagement.html?courseId=${currentCourse.id}&sectionId=${sectionId}&courseName=${encodeURIComponent(currentCourse.name)}&sectionName=${encodeURIComponent(sectionName)}`;
        }

        // Add section function
        function addSection() {
            const form = document.getElementById('addSectionForm');
            if (form.checkValidity()) {
                alert('Section added successfully!');
                bootstrap.Modal.getInstance(document.getElementById('addSectionModal')).hide();
                form.reset();
                // Reload sections
                loadCourseSections(currentCourse.id);
            } else {
                form.reportValidity();
            }
        }
        
        // Populate edit course form with current course data
        function populateEditCourseForm() {
            if (currentCourse) {
                document.getElementById('editCourseId').value = currentCourse.id;
                document.getElementById('editCourseName').value = currentCourse.name;
                document.getElementById('editCourseCode').value = currentCourse.code;
                document.getElementById('editCourseDescription').value = currentCourse.description;
                document.getElementById('editCourseInstructor').value = currentCourse.instructor;
                
                // Set default values for new fields
                document.getElementById('editCourseStatus').value = 'active';
                document.getElementById('editCourseDuration').value = '12';
                document.getElementById('editCourseCredits').value = '3';
                document.getElementById('editCourseLevel').value = 'intermediate';
                document.getElementById('editCoursePrerequisites').value = '';
            }
        }
        
        // Update course function
        function updateCourse() {
            const form = document.getElementById('editCourseForm');
            
            if (form.checkValidity()) {
                // Get form data
                const updatedCourse = {
                    id: parseInt(document.getElementById('editCourseId').value),
                    name: document.getElementById('editCourseName').value,
                    code: document.getElementById('editCourseCode').value,
                    description: document.getElementById('editCourseDescription').value,
                    instructor: document.getElementById('editCourseInstructor').value,
                    status: document.getElementById('editCourseStatus').value,
                    duration: document.getElementById('editCourseDuration').value,
                    credits: document.getElementById('editCourseCredits').value,
                    level: document.getElementById('editCourseLevel').value,
                    prerequisites: document.getElementById('editCoursePrerequisites').value,
                    sections: currentCourse.sections,
                    materials: currentCourse.materials
                };
                
                // Update the current course object
                currentCourse = updatedCourse;
                
                // Update the courses array (in a real app, this would be sent to server)
                const courseIndex = courses.findIndex(c => c.id === updatedCourse.id);
                if (courseIndex !== -1) {
                    courses[courseIndex] = updatedCourse;
                }
                
                // Update sessionStorage
                sessionStorage.setItem('selectedCourse', JSON.stringify(updatedCourse));
                
                // Refresh the display with updated data
                displayCourseDetails(updatedCourse);
                
                // Close modal and show success message
                bootstrap.Modal.getInstance(document.getElementById('editCourseModal')).hide();
                
                // Show success message
                showSuccessMessage('Course updated successfully!');
                
            } else {
                form.reportValidity();
            }
        }
        
        // Show success message function
        function showSuccessMessage(message) {
            // Create a toast-like notification
            const toast = document.createElement('div');
            toast.className = 'alert alert-success alert-dismissible fade show position-fixed';
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(toast);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
