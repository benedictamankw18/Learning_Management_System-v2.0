<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Management - Learning Management System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
        }
        
        .quiz-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .page-header {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.15);
        }
        
        .breadcrumb-nav {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .breadcrumb-nav .breadcrumb {
            margin: 0;
        }
        
        .breadcrumb-nav .breadcrumb-item a {
            color: #28a745;
            text-decoration: none;
            font-weight: 500;
        }
        
        .breadcrumb-nav .breadcrumb-item a:hover {
            text-decoration: underline;
        }
        
        /* Course List View */
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .course-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.15);
            border-color: #28a745;
        }
        
        .course-card .course-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #28a745, #1e7e34);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .course-card .course-icon i {
            font-size: 24px;
            color: white;
        }
        
        .course-card h5 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .course-card .course-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .course-card .sections-count {
            color: #6c757d;
            font-size: 14px;
        }
        
        .course-card .quizzes-count {
            background: #e8f5e8;
            color: #155724;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Course Sections View */
        .course-sections {
            display: none;
        }
        
        .course-info-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .section-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid #28a745;
        }
        
        .section-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.15);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        
        .section-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .btn-action {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-view {
            background: #e8f5e8;
            color: #155724;
        }
        
        .btn-add {
            background: #d4edda;
            color: #0a3622;
        }
        
        .btn-view:hover {
            background: #c3e6cb;
        }
        
        .btn-add:hover {
            background: #b8dabd;
        }
        
        /* Quiz Management View */
        .quiz-management {
            display: none;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .table-responsive {
            border-radius: 12px;
        }
        
        .table thead th {
            background: #f8f9fa;
            border: none;
            font-weight: 600;
            color: #2c3e50;
            padding: 15px;
        }
        
        .table tbody td {
            padding: 15px;
            vertical-align: middle;
            border-top: 1px solid #f1f3f4;
        }
        
        .quiz-icon {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            background: #e8f5e8;
            color: #155724;
        }
        
        .btn-sm-custom {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            margin: 0 2px;
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .back-btn:hover {
            background: #5a6268;
            color: white;
            transform: translateX(-2px);
        }
        
        /* Modal Styles */
        .modal-content {
            border-radius: 15px;
            border: none;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        
        .btn-close-white {
            filter: brightness(0) invert(1);
        }
        
        /* Excel Format Guide */
        .excel-format {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .excel-format table {
            font-size: 12px;
        }
        
        .excel-format th {
            background: #e9ecef;
            font-weight: 600;
        }
        
        /* Hide/Show Views */
        .view-active {
            display: block !important;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="mb-2">
                <i class="fas fa-question-circle me-3"></i>
                Quiz Management
            </h1>
            <p class="mb-0 opacity-75">Create and manage course quizzes and assessments</p>
        </div>

        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb-nav">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb" id="breadcrumb">
                    <li class="breadcrumb-item active">All Courses</li>
                </ol>
            </nav>
        </div>

        <!-- VIEW 1: Course List -->
        <div id="courseListView" class="view-active">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-success">
                    <i class="fas fa-graduation-cap me-2"></i>
                    Select a Course
                </h3>
                <div class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Click on a course to manage its quizzes
                </div>
            </div>
            
            <div class="course-grid" id="courseGrid">
                <!-- Courses will be loaded here -->
            </div>
        </div>

        <!-- VIEW 2: Course Sections -->
        <div id="courseSectionsView" class="course-sections">
            <button class="back-btn mb-4" onclick="showCourseList()">
                <i class="fas fa-arrow-left"></i>
                Back to Courses
            </button>

            <!-- Selected Course Info -->
            <div class="course-info-card">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h3 class="text-success mb-2" id="selectedCourseTitle">Course Title</h3>
                        <p class="text-muted mb-0" id="selectedCourseDesc">Course description and details</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="d-flex justify-content-end gap-3">
                            <div class="text-center">
                                <div class="h4 text-success mb-0" id="totalSections">0</div>
                                <small class="text-muted">Sections</small>
                            </div>
                            <div class="text-center">
                                <div class="h4 text-warning mb-0" id="totalQuizzes">0</div>
                                <small class="text-muted">Quizzes</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Sections -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="text-success">
                    <i class="fas fa-list me-2"></i>
                    Course Sections
                </h4>
                <div class="text-muted">
                    <small>Select a section to manage its quizzes</small>
                </div>
            </div>

            <div class="sections-grid" id="sectionsGrid">
                <!-- Sections will be loaded here -->
            </div>
        </div>

        <!-- VIEW 3: Quiz Management -->
        <div id="quizManagementView" class="quiz-management">
            <button class="back-btn mb-4" onclick="showCourseList()">
                <i class="fas fa-arrow-left"></i>
                Back to Courses
            </button>

            <!-- Quiz Header -->
            <div class="quiz-header">
                <div>
                    <h4 class="text-success mb-1" id="sectionTitle">Section Title</h4>
                    <p class="text-muted mb-0" id="sectionDescription">Section description</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-info" onclick="viewQuizSubmissions()">
                        <i class="fas fa-clipboard-list me-2"></i>
                        View Submissions
                    </button>
                    <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#addQuizModal">
                        <i class="fas fa-plus me-2"></i>
                        Add Quiz
                    </button>
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#uploadExcelModal">
                        <i class="fas fa-file-excel me-2"></i>
                        Upload Excel
                    </button>
                </div>
            </div>

            <!-- Quiz Table -->
            <div class="quiz-table">
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="quizTable">
                        <thead>
                            <tr>
                                <th>Quiz</th>
                                <th>Schedule</th>
                                <th>Duration</th>
                                <th>Attempts</th>
                                <th>Questions</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quizTableBody">
                            <!-- Quizzes will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- VIEW 4: Questions Management -->
        <div id="questionsManagementView" class="quiz-management" style="display: none;">
            <button class="back-btn mb-4" onclick="backToQuizManagement()">
                <i class="fas fa-arrow-left"></i>
                Back to Quizzes
            </button>

            <!-- Questions Header -->
            <div class="quiz-header">
                <div>
                    <h4 class="text-primary mb-1" id="questionsQuizTitle">Quiz Title</h4>
                    <p class="text-muted mb-0" id="questionsQuizInfo">Quiz information</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addQuestionModal">
                        <i class="fas fa-plus me-2"></i>
                        Add Question
                    </button>
                    <button class="btn btn-primary" onclick="previewQuiz()">
                        <i class="fas fa-play me-2"></i>
                        Preview Quiz
                    </button>
                </div>
            </div>

            <!-- Questions List -->
            <div class="quiz-table">
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="questionsTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">#</th>
                                <th>Question</th>
                                <th style="width: 120px;">Type</th>
                                <th style="width: 100px;">Points</th>
                                <th style="width: 100px;">Difficulty</th>
                                <th style="width: 150px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="questionsTableBody">
                            <!-- Questions will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Quiz Modal -->
    <div class="modal fade" id="addQuizModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus me-2"></i>
                        Create New Quiz
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addQuizForm">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="quizTitle" class="form-label">Quiz Title</label>
                                <input type="text" class="form-control" id="quizTitle" placeholder="Enter quiz title" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="quizDuration" class="form-label">Duration (minutes)</label>
                                <input type="number" class="form-control" id="quizDuration" min="5" max="180" placeholder="30" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="quizDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="quizDescription" rows="3" placeholder="Brief description of the quiz..."></textarea>
                        </div>
                        
                        <!-- Quiz Schedule -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="quizStartDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="quizStartDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="quizStartTime" class="form-label">Start Time</label>
                                <input type="time" class="form-control" id="quizStartTime" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="quizEndDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="quizEndDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="quizEndTime" class="form-label">End Time</label>
                                <input type="time" class="form-control" id="quizEndTime" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="quizMaxAttempts" class="form-label">Max Attempts</label>
                                <input type="number" class="form-control" id="quizMaxAttempts" min="1" max="10" value="3" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="quizStatus" class="form-label">Status</label>
                                <select class="form-select" id="quizStatus" required>
                                    <option value="draft">Draft</option>
                                    <option value="active">Active</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="quizType" class="form-label">Quiz Type</label>
                                <select class="form-select" id="quizType" required>
                                    <option value="practice">Practice Quiz</option>
                                    <option value="graded">Graded Quiz</option>
                                    <option value="exam">Exam</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="quizIsActivated" checked>
                                    <label class="form-check-label" for="quizIsActivated">
                                        <strong>Activate Quiz</strong> - Students can take this quiz when activated
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="createQuiz()">
                        <i class="fas fa-save me-2"></i>Create Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Excel Modal -->
    <div class="modal fade" id="uploadExcelModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file-excel me-2"></i>
                        Upload Quiz from Excel
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadExcelForm">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="excelQuizTitle" class="form-label">Quiz Title</label>
                                <input type="text" class="form-control" id="excelQuizTitle" placeholder="Enter quiz title" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="excelQuizDuration" class="form-label">Duration (minutes)</label>
                                <input type="number" class="form-control" id="excelQuizDuration" min="5" max="180" placeholder="30" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="excelFile" class="form-label">Excel File</label>
                            <input type="file" class="form-control" id="excelFile" accept=".xlsx,.xls" required>
                            <div class="form-text">Upload an Excel file with questions in the specified format below</div>
                        </div>
                        
                        <!-- Excel Format Guide -->
                        <div class="excel-format">
                            <h6 class="mb-3"><i class="fas fa-info-circle me-2"></i>Excel Format Requirements</h6>
                            <p class="mb-2">Your Excel file must have the following columns in this exact order:</p>
                            <div class="table-responsive">
                                <table class="table table-bordered table-sm">
                                    <thead>
                                        <tr>
                                            <th>Column A</th>
                                            <th>Column B</th>
                                            <th>Column C</th>
                                            <th>Column D</th>
                                            <th>Column E</th>
                                            <th>Column F</th>
                                        tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>Question</strong></td>
                                            <td><strong>A</strong></td>
                                            <td><strong>B</strong></td>
                                            <td><strong>C</strong></td>
                                            <td><strong>D</strong></td>
                                            <td><strong>Answer</strong></td>
                                        </tr>
                                        <tr class="table-light">
                                            <td>What is 2+2?</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>B</td>
                                        </tr>
                                        <tr class="table-light">
                                            <td>What is the capital of France?</td>
                                            <td>London</td>
                                            <td>Berlin</td>
                                            <td>Paris</td>
                                            <td>Madrid</td>
                                            <td>C</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="alert alert-warning alert-sm mt-2">
                                <strong>Important:</strong> 
                                <ul class="mb-0 mt-1">
                                    <li>The Answer column should contain A, B, C, or D</li>
                                    <li>First row should contain headers</li>
                                    <li>Questions start from row 2</li>
                                    <li>All cells must be filled</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="excelQuizStatus" class="form-label">Status</label>
                                <select class="form-select" id="excelQuizStatus" required>
                                    <option value="draft">Draft</option>
                                    <option value="active">Active</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="excelQuizType" class="form-label">Quiz Type</label>
                                <select class="form-select" id="excelQuizType" required>
                                    <option value="practice">Practice Quiz</option>
                                    <option value="graded">Graded Quiz</option>
                                    <option value="exam">Exam</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="uploadExcelQuiz()">
                        <i class="fas fa-upload me-2"></i>Upload Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Question Modal -->
    <div class="modal fade" id="addQuestionModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus me-2"></i>
                        Add New Question
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addQuestionForm">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="questionText" class="form-label">Question Text</label>
                                <textarea class="form-control" id="questionText" rows="3" placeholder="Enter the question text..." required></textarea>
                            </div>
                            <div class="col-md-4">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <label for="questionType" class="form-label">Question Type</label>
                                        <select class="form-select" id="questionType" onchange="toggleAnswerFields()" required>
                                            <option value="multiple-choice">Multiple Choice</option>
                                            <option value="true-false">True/False</option>
                                            <option value="short-answer">Short Answer</option>
                                            <option value="essay">Essay</option>
                                        </select>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="questionPoints" class="form-label">Points</label>
                                        <input type="number" class="form-control" id="questionPoints" min="1" max="100" value="1" required>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="questionDifficulty" class="form-label">Difficulty</label>
                                        <select class="form-select" id="questionDifficulty" required>
                                            <option value="easy">Easy</option>
                                            <option value="medium">Medium</option>
                                            <option value="hard">Hard</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Multiple Choice Options -->
                        <div id="multipleChoiceOptions">
                            <h6 class="mb-3">Answer Options</h6>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Option A</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="radio" name="correctAnswer" value="A" required>
                                        </div>
                                        <input type="text" class="form-control" id="optionA" placeholder="Enter option A" required>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Option B</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="radio" name="correctAnswer" value="B" required>
                                        </div>
                                        <input type="text" class="form-control" id="optionB" placeholder="Enter option B" required>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Option C</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="radio" name="correctAnswer" value="C" required>
                                        </div>
                                        <input type="text" class="form-control" id="optionC" placeholder="Enter option C" required>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Option D</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="radio" name="correctAnswer" value="D" required>
                                        </div>
                                        <input type="text" class="form-control" id="optionD" placeholder="Enter option D" required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- True/False Options -->
                        <div id="trueFalseOptions" style="display: none;">
                            <h6 class="mb-3">Correct Answer</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="tfAnswer" id="tfTrue" value="true">
                                        <label class="form-check-label" for="tfTrue">True</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="tfAnswer" id="tfFalse" value="false">
                                        <label class="form-check-label" for="tfFalse">False</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Short Answer/Essay -->
                        <div id="textAnswerOptions" style="display: none;">
                            <div class="mb-3">
                                <label for="correctAnswer" class="form-label">Sample Correct Answer (Optional)</label>
                                <textarea class="form-control" id="correctAnswer" rows="2" placeholder="Provide a sample answer or key points..."></textarea>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="questionExplanation" class="form-label">Explanation (Optional)</label>
                            <textarea class="form-control" id="questionExplanation" rows="2" placeholder="Provide an explanation for the correct answer..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addQuestion()">
                        <i class="fas fa-save me-2"></i>Add Question
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Question Modal -->
    <div class="modal fade" id="editQuestionModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>
                        Edit Question
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editQuestionForm">
                        <input type="hidden" id="editQuestionId">
                        <!-- Same structure as add question form -->
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="editQuestionText" class="form-label">Question Text</label>
                                <textarea class="form-control" id="editQuestionText" rows="3" required></textarea>
                            </div>
                            <div class="col-md-4">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <label for="editQuestionType" class="form-label">Question Type</label>
                                        <select class="form-select" id="editQuestionType" onchange="toggleEditAnswerFields()" required>
                                            <option value="multiple-choice">Multiple Choice</option>
                                            <option value="true-false">True/False</option>
                                            <option value="short-answer">Short Answer</option>
                                            <option value="essay">Essay</option>
                                        </select>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="editQuestionPoints" class="form-label">Points</label>
                                        <input type="number" class="form-control" id="editQuestionPoints" min="1" max="100" required>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="editQuestionDifficulty" class="form-label">Difficulty</label>
                                        <select class="form-select" id="editQuestionDifficulty" required>
                                            <option value="easy">Easy</option>
                                            <option value="medium">Medium</option>
                                            <option value="hard">Hard</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Multiple Choice Options -->
                        <div id="editMultipleChoiceOptions">
                            <h6 class="mb-3">Answer Options</h6>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Option A</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="radio" name="editCorrectAnswer" value="A">
                                        </div>
                                        <input type="text" class="form-control" id="editOptionA">
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Option B</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="radio" name="editCorrectAnswer" value="B">
                                        </div>
                                        <input type="text" class="form-control" id="editOptionB">
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Option C</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="radio" name="editCorrectAnswer" value="C">
                                        </div>
                                        <input type="text" class="form-control" id="editOptionC">
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Option D</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input" type="radio" name="editCorrectAnswer" value="D">
                                        </div>
                                        <input type="text" class="form-control" id="editOptionD">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="editQuestionExplanation" class="form-label">Explanation (Optional)</label>
                            <textarea class="form-control" id="editQuestionExplanation" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="updateQuestion()">
                        <i class="fas fa-save me-2"></i>Update Question
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Question Modal -->
    <div class="modal fade" id="viewQuestionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-eye me-2"></i>
                        Question Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <h5 id="viewQuestionText" class="text-primary">Question Text</h5>
                        </div>
                        <div class="col-md-4 text-end">
                            <span id="viewQuestionType" class="badge bg-info">Multiple Choice</span>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h5 text-success mb-1" id="viewQuestionPoints">1</div>
                                <small class="text-muted">Points</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h6 text-warning mb-1" id="viewQuestionDifficulty">Medium</div>
                                <small class="text-muted">Difficulty</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h6 text-muted mb-1" id="viewQuestionNumber">1</div>
                                <small class="text-muted">Question #</small>
                            </div>
                        </div>
                    </div>
                    
                    <div id="viewQuestionOptions" class="mb-3">
                        <!-- Options will be displayed here -->
                    </div>
                    
                    <div id="viewQuestionExplanation" class="alert alert-info" style="display: none;">
                        <strong>Explanation:</strong> <span id="explanationText"></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" onclick="editQuestionFromView()">
                        <i class="fas fa-edit me-2"></i>Edit Question
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Question Modal -->
    <div class="modal fade" id="deleteQuestionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-trash me-2"></i>
                        Delete Question
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle text-warning fa-3x mb-3"></i>
                        <h5>Are you sure you want to delete this question?</h5>
                        <p class="text-muted mb-3">
                            <strong>Question #<span id="deleteQuestionNumber">1</span></strong><br>
                            This action cannot be undone. The question will be permanently removed from the quiz.
                        </p>
                        <input type="hidden" id="deleteQuestionId">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteQuestion()">
                        <i class="fas fa-trash me-2"></i>Yes, Delete Question
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Quiz Modal -->
    <div class="modal fade" id="viewQuizModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-eye me-2"></i>
                        Quiz Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h4 id="viewQuizTitle" class="text-success mb-2">Quiz Title</h4>
                            <p id="viewQuizDescription" class="text-muted mb-3">Quiz description will appear here...</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <span id="viewQuizStatus" class="badge bg-success">Active</span>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-2">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-primary mb-1" id="viewQuizQuestions">0</div>
                                <small class="text-muted">Questions</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-warning mb-1" id="viewQuizDuration">0</div>
                                <small class="text-muted">Minutes</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-success mb-1" id="viewQuizMaxAttempts">0</div>
                                <small class="text-muted">Max Attempts</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-info mb-1" id="viewQuizType">Practice</div>
                                <small class="text-muted">Type</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h6 text-muted mb-1" id="viewQuizCreated">2025-01-01</div>
                                <small class="text-muted">Created</small>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h6 mb-1" id="viewQuizActivation">Active</div>
                                <small class="text-muted">Status</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quiz Schedule Information -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="alert alert-success">
                                <i class="fas fa-calendar-check me-2"></i>
                                <strong>Start:</strong> <span id="viewQuizStartDateTime">2025-08-10 09:00</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-warning">
                                <i class="fas fa-calendar-times me-2"></i>
                                <strong>End:</strong> <span id="viewQuizEndDateTime">2025-08-20 23:59</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Section:</strong> <span id="viewQuizSection">Section Name</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" onclick="editQuizFromView()">
                        <i class="fas fa-edit me-2"></i>Edit Quiz
                    </button>
                    <button type="button" class="btn btn-primary" onclick="manageQuestions()">
                        <i class="fas fa-question me-2"></i>Manage Questions
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Quiz Modal -->
    <div class="modal fade" id="editQuizModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>
                        Edit Quiz
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editQuizForm">
                        <input type="hidden" id="editQuizId">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="editQuizTitle" class="form-label">Quiz Title</label>
                                <input type="text" class="form-control" id="editQuizTitle" placeholder="Enter quiz title" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editQuizDuration" class="form-label">Duration (minutes)</label>
                                <input type="number" class="form-control" id="editQuizDuration" min="5" max="180" placeholder="30" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editQuizDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editQuizDescription" rows="3" placeholder="Brief description of the quiz..."></textarea>
                        </div>
                        
                        <!-- Quiz Schedule -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editQuizStartDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="editQuizStartDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editQuizStartTime" class="form-label">Start Time</label>
                                <input type="time" class="form-control" id="editQuizStartTime" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editQuizEndDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="editQuizEndDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editQuizEndTime" class="form-label">End Time</label>
                                <input type="time" class="form-control" id="editQuizEndTime" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="editQuizMaxAttempts" class="form-label">Max Attempts</label>
                                <input type="number" class="form-control" id="editQuizMaxAttempts" min="1" max="10" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="editQuizQuestions" class="form-label">Number of Questions</label>
                                <input type="number" class="form-control" id="editQuizQuestions" min="1" max="100" placeholder="10" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="editQuizStatus" class="form-label">Status</label>
                                <select class="form-select" id="editQuizStatus" required>
                                    <option value="draft">Draft</option>
                                    <option value="active">Active</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="editQuizType" class="form-label">Quiz Type</label>
                                <select class="form-select" id="editQuizType" required>
                                    <option value="practice">Practice Quiz</option>
                                    <option value="graded">Graded Quiz</option>
                                    <option value="exam">Exam</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="editQuizIsActivated">
                                    <label class="form-check-label" for="editQuizIsActivated">
                                        <strong>Activate Quiz</strong> - Students can take this quiz when activated
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="updateQuiz()">
                        <i class="fas fa-save me-2"></i>Update Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Quiz Modal -->
    <div class="modal fade" id="deleteQuizModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-trash me-2"></i>
                        Delete Quiz
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle text-warning fa-3x mb-3"></i>
                        <h5>Are you sure you want to delete this quiz?</h5>
                        <p class="text-muted mb-3">
                            <strong id="deleteQuizTitle">Quiz Title</strong><br>
                            This action cannot be undone. All quiz questions and student attempts will be permanently deleted.
                        </p>
                        <input type="hidden" id="deleteQuizId">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteQuiz()">
                        <i class="fas fa-trash me-2"></i>Yes, Delete Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Notification Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-check-circle me-2"></i>
                        Success
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
                    <h5 id="successMessage">Operation completed successfully!</h5>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Notification Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Error
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-exclamation-triangle text-danger fa-3x mb-3"></i>
                    <h5 id="errorMessage">An error occurred!</h5>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Action Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">
                        <i class="fas fa-question-circle me-2"></i>
                        Confirm Action
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-question-circle text-warning fa-3x mb-3"></i>
                    <h5 id="confirmMessage">Are you sure you want to continue?</h5>
                    <p class="text-muted" id="confirmDetails"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" id="confirmButton" onclick="executeConfirmAction()">
                        <i class="fas fa-check me-2"></i>Yes, Continue
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toggle Quiz Activation Modal -->
    <div class="modal fade" id="toggleActivationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-toggle-on me-2"></i>
                        <span id="toggleActionTitle">Toggle Quiz Status</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-toggle-on text-info fa-3x mb-3" id="toggleIcon"></i>
                    <h5 id="toggleMessage">Change quiz activation status?</h5>
                    <p class="text-muted" id="toggleDetails"></p>
                    <input type="hidden" id="toggleQuizId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-info" id="toggleConfirmButton" onclick="executeToggleActivation()">
                        <i class="fas fa-toggle-on me-2"></i>
                        <span id="toggleButtonText">Confirm</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Sample Data
        const courses = [
            {
                id: 1,
                code: 'CS101',
                name: 'Introduction to Computer Science',
                description: 'Basic concepts of programming and computer science fundamentals',
                instructor: 'Dr. Kwame Asante',
                sections: 5,
                quizzes: 8
            },
            {
                id: 2,
                code: 'MATH201',
                name: 'Calculus II',
                description: 'Advanced calculus including integration techniques and applications',
                instructor: 'Prof. Ama Osei',
                sections: 4,
                quizzes: 6
            },
            {
                id: 3,
                code: 'EDU301',
                name: 'Educational Psychology',
                description: 'Psychological principles applied to educational settings',
                instructor: 'Dr. Kofi Mensah',
                sections: 6,
                quizzes: 5
            },
            {
                id: 4,
                code: 'BUS205',
                name: 'Business Ethics',
                description: 'Ethical decision-making in business contexts',
                instructor: 'Mrs. Akosua Darko',
                sections: 4,
                quizzes: 4
            }
        ];

        const courseSections = {
            1: [
                { id: 1, name: 'Introduction to Programming', description: 'Basic programming concepts', quizzes: 2 },
                { id: 2, name: 'Data Types and Variables', description: 'Understanding data types', quizzes: 1 },
                { id: 3, name: 'Control Structures', description: 'Loops and conditionals', quizzes: 2 },
                { id: 4, name: 'Functions and Methods', description: 'Creating reusable code', quizzes: 1 },
                { id: 5, name: 'Object-Oriented Programming', description: 'OOP principles', quizzes: 2 }
            ],
            2: [
                { id: 6, name: 'Integration Techniques', description: 'Various integration methods', quizzes: 2 },
                { id: 7, name: 'Applications of Integration', description: 'Real-world applications', quizzes: 1 },
                { id: 8, name: 'Differential Equations', description: 'Solving differential equations', quizzes: 2 },
                { id: 9, name: 'Series and Sequences', description: 'Infinite series', quizzes: 1 }
            ]
        };

        const sectionQuizzes = {
            1: [
                { 
                    id: 1, 
                    title: 'Programming Basics Quiz', 
                    description: 'Test your understanding of basic programming concepts including variables, data types, and simple operations.', 
                    questions: 10, 
                    duration: 20, 
                    created: '2025-01-15', 
                    status: 'active', 
                    type: 'practice', 
                    section: 'Introduction to Programming',
                    startDate: '2025-08-10',
                    startTime: '09:00',
                    endDate: '2025-08-20',
                    endTime: '23:59',
                    maxAttempts: 3,
                    isActivated: true
                },
                { 
                    id: 2, 
                    title: 'Introduction Assessment', 
                    description: 'Comprehensive assessment covering all introductory programming topics with emphasis on problem-solving.', 
                    questions: 15, 
                    duration: 30, 
                    created: '2025-01-16', 
                    status: 'active', 
                    type: 'graded', 
                    section: 'Introduction to Programming',
                    startDate: '2025-08-15',
                    startTime: '10:00',
                    endDate: '2025-08-25',
                    endTime: '18:00',
                    maxAttempts: 2,
                    isActivated: true
                }
            ],
            2: [
                { 
                    id: 3, 
                    title: 'Data Types Test', 
                    description: 'Evaluate your knowledge of different data types, type conversion, and data manipulation techniques.', 
                    questions: 8, 
                    duration: 15, 
                    created: '2025-01-18', 
                    status: 'active', 
                    type: 'practice', 
                    section: 'Data Types and Variables',
                    startDate: '2025-08-12',
                    startTime: '14:00',
                    endDate: '2025-08-22',
                    endTime: '16:00',
                    maxAttempts: 5,
                    isActivated: true
                }
            ],
            3: [
                { 
                    id: 4, 
                    title: 'Control Structures Quiz', 
                    description: 'Practice quiz focusing on if-else statements, switch cases, and logical operators.', 
                    questions: 12, 
                    duration: 25, 
                    created: '2025-01-20', 
                    status: 'active', 
                    type: 'practice', 
                    section: 'Control Structures',
                    startDate: '2025-08-18',
                    startTime: '11:00',
                    endDate: '2025-08-28',
                    endTime: '15:30',
                    maxAttempts: 3,
                    isActivated: false
                },
                { 
                    id: 5, 
                    title: 'Loops and Conditionals Test', 
                    description: 'Advanced assessment on for loops, while loops, nested loops, and complex conditional statements.', 
                    questions: 10, 
                    duration: 20, 
                    created: '2025-01-22', 
                    status: 'draft', 
                    type: 'graded', 
                    section: 'Control Structures',
                    startDate: '2025-08-25',
                    startTime: '13:00',
                    endDate: '2025-09-05',
                    endTime: '17:00',
                    maxAttempts: 2,
                    isActivated: false
                }
            ],
            4: [
                { 
                    id: 6, 
                    title: 'Functions Quiz', 
                    description: 'Test your understanding of function creation, parameters, return values, and scope.', 
                    questions: 8, 
                    duration: 15, 
                    created: '2025-01-25', 
                    status: 'active', 
                    type: 'practice', 
                    section: 'Functions and Methods',
                    startDate: '2025-08-20',
                    startTime: '10:30',
                    endDate: '2025-08-30',
                    endTime: '14:00',
                    maxAttempts: 4,
                    isActivated: true
                }
            ],
            5: [
                { 
                    id: 7, 
                    title: 'OOP Concepts Quiz', 
                    description: 'Comprehensive quiz covering classes, objects, inheritance, polymorphism, and encapsulation.', 
                    questions: 15, 
                    duration: 30, 
                    created: '2025-01-28', 
                    status: 'active', 
                    type: 'graded', 
                    section: 'Object-Oriented Programming',
                    startDate: '2025-08-22',
                    startTime: '09:00',
                    endDate: '2025-09-01',
                    endTime: '18:00',
                    maxAttempts: 2,
                    isActivated: true
                },
                { 
                    id: 8, 
                    title: 'OOP Final Exam', 
                    description: 'Final examination covering all object-oriented programming concepts with practical coding problems.', 
                    questions: 25, 
                    duration: 60, 
                    created: '2025-01-30', 
                    status: 'draft', 
                    type: 'exam', 
                    section: 'Object-Oriented Programming',
                    startDate: '2025-09-05',
                    startTime: '08:00',
                    endDate: '2025-09-15',
                    endTime: '12:00',
                    maxAttempts: 1,
                    isActivated: false
                }
            ],
            6: [
                { 
                    id: 9, 
                    title: 'Integration Methods Quiz', 
                    description: 'Practice quiz on basic integration techniques including substitution and integration by parts.', 
                    questions: 10, 
                    duration: 20, 
                    created: '2025-02-01', 
                    status: 'active', 
                    type: 'practice', 
                    section: 'Integration Techniques',
                    startDate: '2025-08-28',
                    startTime: '08:00',
                    endDate: '2025-09-07',
                    endTime: '20:00',
                    maxAttempts: 3,
                    isActivated: true
                },
                { 
                    id: 10, 
                    title: 'Advanced Integration Test', 
                    description: 'Comprehensive test covering partial fractions, trigonometric substitution, and advanced techniques.', 
                    questions: 12, 
                    duration: 25, 
                    created: '2025-02-03', 
                    status: 'active', 
                    type: 'graded', 
                    section: 'Integration Techniques',
                    startDate: '2025-09-01',
                    startTime: '10:00',
                    endDate: '2025-09-10',
                    endTime: '16:00',
                    maxAttempts: 2,
                    isActivated: true
                }
            ],
            7: [
                { 
                    id: 11, 
                    title: 'Applications Quiz', 
                    description: 'Real-world applications of integration including area, volume, and physics problems.', 
                    questions: 8, 
                    duration: 15, 
                    created: '2025-02-05', 
                    status: 'active', 
                    type: 'practice', 
                    section: 'Applications of Integration',
                    startDate: '2025-09-05',
                    startTime: '14:00',
                    endDate: '2025-09-15',
                    endTime: '18:00',
                    maxAttempts: 4,
                    isActivated: false
                }
            ],
            8: [
                { 
                    id: 12, 
                    title: 'Differential Equations Quiz', 
                    description: 'Introduction to solving first-order and second-order differential equations.', 
                    questions: 15, 
                    duration: 30, 
                    created: '2025-02-08', 
                    status: 'active', 
                    type: 'graded', 
                    section: 'Differential Equations',
                    startDate: '2025-09-08',
                    startTime: '09:30',
                    endDate: '2025-09-18',
                    endTime: '12:00',
                    maxAttempts: 2,
                    isActivated: true
                },
                { 
                    id: 13, 
                    title: 'DE Solutions Test', 
                    description: 'Practice test on various methods for solving differential equations and their applications.', 
                    questions: 10, 
                    duration: 20, 
                    created: '2025-02-10', 
                    status: 'draft', 
                    type: 'practice', 
                    section: 'Differential Equations',
                    startDate: '2025-09-12',
                    startTime: '15:00',
                    endDate: '2025-09-22',
                    endTime: '17:30',
                    maxAttempts: 5,
                    isActivated: false
                }
            ],
            9: [
                { 
                    id: 14, 
                    title: 'Series and Sequences Quiz', 
                    description: 'Comprehensive assessment on convergence tests, power series, and Taylor series expansions.', 
                    questions: 12, 
                    duration: 25, 
                    created: '2025-02-12', 
                    status: 'active', 
                    type: 'graded', 
                    section: 'Series and Sequences',
                    startDate: '2025-09-15',
                    startTime: '11:00',
                    endDate: '2025-09-25',
                    endTime: '14:00',
                    maxAttempts: 2,
                    isActivated: true
                }
            ]
        };

        // Course quizzes mapping - aggregate all quizzes for each course
        const courseQuizzes = {
            1: [...(sectionQuizzes[1] || []), ...(sectionQuizzes[2] || []), ...(sectionQuizzes[3] || []), ...(sectionQuizzes[4] || []), ...(sectionQuizzes[5] || [])],
            2: [...(sectionQuizzes[6] || []), ...(sectionQuizzes[7] || []), ...(sectionQuizzes[8] || []), ...(sectionQuizzes[9] || [])]
        };

        // Questions data for each quiz
        const quizQuestions = {
            1: [
                {
                    id: 1,
                    text: "What is a variable in programming?",
                    type: "multiple-choice",
                    options: {
                        A: "A fixed value that cannot change",
                        B: "A storage location with an associated name",
                        C: "A function that returns data",
                        D: "A loop construct"
                    },
                    correctAnswer: "B",
                    points: 2,
                    difficulty: "easy",
                    explanation: "A variable is a storage location paired with an associated symbolic name that contains data, referred to as a value."
                },
                {
                    id: 2,
                    text: "Programming languages are case-sensitive.",
                    type: "true-false",
                    correctAnswer: "false",
                    points: 1,
                    difficulty: "easy",
                    explanation: "Not all programming languages are case-sensitive. For example, Python is case-sensitive, but SQL is not."
                },
                {
                    id: 3,
                    text: "What does IDE stand for?",
                    type: "short-answer",
                    correctAnswer: "Integrated Development Environment",
                    points: 1,
                    difficulty: "medium",
                    explanation: "IDE stands for Integrated Development Environment - a software application providing comprehensive facilities for software development."
                }
            ],
            2: [
                {
                    id: 4,
                    text: "Which of the following is NOT a primitive data type in most programming languages?",
                    type: "multiple-choice",
                    options: {
                        A: "Integer",
                        B: "Boolean",
                        C: "String",
                        D: "Array"
                    },
                    correctAnswer: "D",
                    points: 2,
                    difficulty: "medium",
                    explanation: "Array is a composite data type, not a primitive one. Primitive types are basic data types built into the language."
                }
            ]
        };

        let currentQuiz = null;
        let currentCourse = null;
        let currentSection = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadCourses();
        });

        // Load courses in the grid
        function loadCourses() {
            const courseGrid = document.getElementById('courseGrid');
            courseGrid.innerHTML = '';

            courses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.className = 'course-card';
                courseCard.onclick = () => showCourseQuizzes(course);
                
                courseCard.innerHTML = `
                    <div class="course-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <h5>${course.name}</h5>
                    <p class="text-muted mb-2">${course.code}</p>
                    <p class="small text-muted">${course.description}</p>
                    <div class="course-meta">
                        <span class="sections-count">
                            <i class="fas fa-list me-1"></i>
                            ${course.sections} sections
                        </span>
                        <span class="quizzes-count">
                            ${course.quizzes} quizzes
                        </span>
                    </div>
                `;
                
                courseGrid.appendChild(courseCard);
            });
        }

        // Show course sections
        function showCourseSections(course) {
            currentCourse = course;
            
            // Update breadcrumb
            document.getElementById('breadcrumb').innerHTML = `
                <li class="breadcrumb-item"><a href="javascript:void(0)" onclick="showCourseList()">All Courses</a></li>
                <li class="breadcrumb-item active">${course.name}</li>
            `;
            
            // Update course info
            document.getElementById('selectedCourseTitle').textContent = course.name;
            document.getElementById('selectedCourseDesc').textContent = `${course.code} - ${course.description}`;
            document.getElementById('totalSections').textContent = course.sections;
            document.getElementById('totalQuizzes').textContent = course.quizzes;
            
            // Load sections
            loadCourseSections(course.id);
            
            // Switch views
            document.getElementById('courseListView').classList.remove('view-active');
            document.getElementById('courseSectionsView').classList.add('view-active');
            document.getElementById('quizManagementView').classList.remove('view-active');
        }

        // Show course quizzes directly
        function showCourseQuizzes(course) {
            currentCourse = course;
            
            // Update breadcrumb
            document.getElementById('breadcrumb').innerHTML = `
                <li class="breadcrumb-item"><a href="javascript:void(0)" onclick="showCourseList()">All Courses</a></li>
                <li class="breadcrumb-item active">${course.name} - Quiz Management</li>
            `;
            
            // Update section info to show course info
            document.getElementById('sectionTitle').textContent = `${course.name} - All Quizzes`;
            document.getElementById('sectionDescription').textContent = `${course.code} - Manage all quizzes for this course`;
            
            // Load all quizzes for this course
            loadCourseQuizzes(course.id);
            
            // Switch views
            document.getElementById('courseListView').classList.remove('view-active');
            document.getElementById('courseSectionsView').classList.remove('view-active');
            document.getElementById('quizManagementView').classList.add('view-active');
        }

        // Show course quizzes directly
        function showCourseQuizzes(course) {
            currentCourse = course;
            
            // Update breadcrumb
            document.getElementById('breadcrumb').innerHTML = `
                <li class="breadcrumb-item"><a href="javascript:void(0)" onclick="showCourseList()">All Courses</a></li>
                <li class="breadcrumb-item active">${course.name} - Quiz Management</li>
            `;
            
            // Update section info to show course info
            document.getElementById('sectionTitle').textContent = `${course.name} - All Quizzes`;
            document.getElementById('sectionDescription').textContent = `${course.code} - Manage all quizzes for this course`;
            
            // Load all quizzes for this course
            loadCourseQuizzes(course.id);
            
            // Switch views
            document.getElementById('courseListView').classList.remove('view-active');
            document.getElementById('courseSectionsView').classList.remove('view-active');
            document.getElementById('quizManagementView').classList.add('view-active');
            document.getElementById('questionsManagementView').classList.remove('view-active');
            
            // Reset display styles for other views
            document.getElementById('questionsManagementView').style.display = 'none';
            document.getElementById('quizManagementView').style.display = 'block';
        }

        // Load course sections
        function loadCourseSections(courseId) {
            const sectionsGrid = document.getElementById('sectionsGrid');
            sectionsGrid.innerHTML = '';
            
            const sections = courseSections[courseId] || [];
            
            sections.forEach(section => {
                const sectionCard = document.createElement('div');
                sectionCard.className = 'section-card';
                
                sectionCard.innerHTML = `
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div>
                            <h6 class="mb-1">${section.name}</h6>
                            <small class="text-muted">${section.quizzes} quizzes</small>
                        </div>
                    </div>
                    <p class="text-muted small mb-3">${section.description}</p>
                    <div class="section-actions">
                        <button class="btn-action btn-view" onclick="showQuizzes(${section.id}, '${section.name}', '${section.description}')">
                            <i class="fas fa-eye me-1"></i>View Quizzes
                        </button>
                        <button class="btn-action btn-add" onclick="showQuizzes(${section.id}, '${section.name}', '${section.description}')">
                            <i class="fas fa-plus me-1"></i>Add Quiz
                        </button>
                    </div>
                `;
                
                sectionsGrid.appendChild(sectionCard);
            });
        }

        // Show quizzes for a section
        function showQuizzes(sectionId, sectionName, sectionDesc) {
            currentSection = sectionId;
            
            // Update breadcrumb
            document.getElementById('breadcrumb').innerHTML = `
                <li class="breadcrumb-item"><a href="javascript:void(0)" onclick="showCourseList()">All Courses</a></li>
                <li class="breadcrumb-item"><a href="javascript:void(0)" onclick="showCourseSections(currentCourse)">${currentCourse.name}</a></li>
                <li class="breadcrumb-item active">${sectionName}</li>
            `;
            
            // Update section info
            document.getElementById('sectionTitle').textContent = sectionName;
            document.getElementById('sectionDescription').textContent = sectionDesc;
            
            // Load quizzes
            loadSectionQuizzes(sectionId);
            
            // Switch views
            document.getElementById('courseListView').classList.remove('view-active');
            document.getElementById('courseSectionsView').classList.remove('view-active');
            document.getElementById('quizManagementView').classList.add('view-active');
        }

        // Load quizzes for a section
        function loadSectionQuizzes(sectionId) {
            const tableBody = document.getElementById('quizTableBody');
            tableBody.innerHTML = '';
            
            const quizzes = sectionQuizzes[sectionId] || [];
            
            if (quizzes.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4 text-muted">
                            <i class="fas fa-question-circle fa-2x mb-2 d-block"></i>
                            No quizzes found. Click "Add Quiz" or "Upload Excel" to create some.
                        </td>
                    </tr>
                `;
                return;
            }
            
            quizzes.forEach(quiz => {
                const row = document.createElement('tr');
                
                const statusClass = quiz.status === 'active' ? 'success' : quiz.status === 'draft' ? 'warning' : 'secondary';
                const typeClass = quiz.type === 'exam' ? 'danger' : quiz.type === 'graded' ? 'primary' : 'info';
                const activationClass = quiz.isActivated ? 'success' : 'danger';
                const activationText = quiz.isActivated ? 'Active' : 'Inactive';
                
                // Format dates
                const startDateTime = `${quiz.startDate} ${quiz.startTime}`;
                const endDateTime = `${quiz.endDate} ${quiz.endTime}`;
                
                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="quiz-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div>
                                <div class="fw-bold">${quiz.title}</div>
                                <small class="text-muted">
                                    <span class="badge bg-${typeClass}">${quiz.type}</span>
                                    ${quiz.section ? `<span class="ms-1">${quiz.section}</span>` : ''}
                                </small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="small">
                            <div><strong>Start:</strong> ${startDateTime}</div>
                            <div><strong>End:</strong> ${endDateTime}</div>
                        </div>
                    </td>
                    <td>
                        <span class="badge bg-info">${quiz.duration} min</span>
                    </td>
                    <td>
                        <span class="badge bg-primary">${quiz.maxAttempts}</span>
                    </td>
                    <td>${quiz.questions} questions</td>
                    <td>
                        <div class="d-flex flex-column gap-1">
                            <span class="badge bg-${statusClass}">${quiz.status}</span>
                            <span class="badge bg-${activationClass}">${activationText}</span>
                        </div>
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm-custom btn-outline-primary" onclick="viewQuiz(${quiz.id})" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm-custom btn-outline-info" onclick="manageQuestionsForQuiz(${quiz.id})" title="Questions">
                                <i class="fas fa-question"></i>
                            </button>
                            <button class="btn btn-sm-custom btn-outline-warning" onclick="editQuiz(${quiz.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm-custom btn-outline-${quiz.isActivated ? 'danger' : 'success'}" 
                                    onclick="toggleQuizActivation(${quiz.id})" 
                                    title="${quiz.isActivated ? 'Deactivate' : 'Activate'}">
                                <i class="fas fa-${quiz.isActivated ? 'toggle-off' : 'toggle-on'}"></i>
                            </button>
                            <button class="btn btn-sm-custom btn-outline-danger" onclick="deleteQuiz(${quiz.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Load all quizzes for a course
        function loadCourseQuizzes(courseId) {
            const tableBody = document.getElementById('quizTableBody');
            tableBody.innerHTML = '';
            
            const quizzes = courseQuizzes[courseId] || [];
            
            if (quizzes.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4 text-muted">
                            <i class="fas fa-question-circle fa-2x mb-2 d-block"></i>
                            No quizzes found for this course. Click "Add Quiz" or "Upload Excel" to create some.
                        </td>
                    </tr>
                `;
                return;
            }
            
            quizzes.forEach(quiz => {
                const row = document.createElement('tr');
                
                const statusClass = quiz.status === 'active' ? 'success' : quiz.status === 'draft' ? 'warning' : 'secondary';
                const typeClass = quiz.type === 'exam' ? 'danger' : quiz.type === 'graded' ? 'primary' : 'info';
                const activationClass = quiz.isActivated ? 'success' : 'danger';
                const activationText = quiz.isActivated ? 'Active' : 'Inactive';
                
                // Format dates
                const startDateTime = `${quiz.startDate} ${quiz.startTime}`;
                const endDateTime = `${quiz.endDate} ${quiz.endTime}`;
                
                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="quiz-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div>
                                <div class="fw-bold">${quiz.title}</div>
                                <small class="text-muted">
                                    <span class="badge bg-${typeClass}">${quiz.type}</span>
                                    ${quiz.section ? `<span class="ms-1">${quiz.section}</span>` : ''}
                                </small>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="small">
                            <div><strong>Start:</strong> ${startDateTime}</div>
                            <div><strong>End:</strong> ${endDateTime}</div>
                        </div>
                    </td>
                    <td>
                        <span class="badge bg-info">${quiz.duration} min</span>
                    </td>
                    <td>
                        <span class="badge bg-primary">${quiz.maxAttempts}</span>
                    </td>
                    <td>${quiz.questions} questions</td>
                    <td>
                        <div class="d-flex flex-column gap-1">
                            <span class="badge bg-${statusClass}">${quiz.status}</span>
                            <span class="badge bg-${activationClass}">${activationText}</span>
                        </div>
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm-custom btn-outline-primary" onclick="viewQuiz(${quiz.id})" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm-custom btn-outline-info" onclick="manageQuestionsForQuiz(${quiz.id})" title="Questions">
                                <i class="fas fa-question"></i>
                            </button>
                            <button class="btn btn-sm-custom btn-outline-warning" onclick="editQuiz(${quiz.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm-custom btn-outline-${quiz.isActivated ? 'danger' : 'success'}" 
                                    onclick="toggleQuizActivation(${quiz.id})" 
                                    title="${quiz.isActivated ? 'Deactivate' : 'Activate'}">
                                <i class="fas fa-${quiz.isActivated ? 'toggle-off' : 'toggle-on'}"></i>
                            </button>
                            <button class="btn btn-sm-custom btn-outline-danger" onclick="deleteQuiz(${quiz.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function createQuiz() {
            const form = document.getElementById('addQuizForm');
            if (form.checkValidity()) {
                showSuccess('Quiz created successfully!');
                bootstrap.Modal.getInstance(document.getElementById('addQuizModal')).hide();
                form.reset();
                // Reload quizzes - check if we're in course view or section view
                if (currentSection) {
                    loadSectionQuizzes(currentSection);
                } else if (currentCourse) {
                    loadCourseQuizzes(currentCourse.id);
                }
            } else {
                form.reportValidity();
            }
        }

        function uploadExcelQuiz() {
            const form = document.getElementById('uploadExcelForm');
            const fileInput = document.getElementById('excelFile');
            
            if (form.checkValidity() && fileInput.files.length > 0) {
                const file = fileInput.files[0];
                
                // Validate file type
                if (!file.name.match(/\.(xlsx|xls)$/)) {
                    showError('Please select a valid Excel file (.xlsx or .xls)');
                    return;
                }
                
                // In a real app, you would parse the Excel file here
                showSuccess(`Excel quiz uploaded successfully! File: ${file.name}`);
                bootstrap.Modal.getInstance(document.getElementById('uploadExcelModal')).hide();
                form.reset();
                // Reload quizzes - check if we're in course view or section view
                if (currentSection) {
                    loadSectionQuizzes(currentSection);
                } else if (currentCourse) {
                    loadCourseQuizzes(currentCourse.id);
                }
            } else {
                form.reportValidity();
            }
        }
        // (Removed stray code block that was outside any function and causing errors)
        

        function deleteQuiz(id) {
            showConfirm(
                'Are you sure you want to delete this quiz?',
                'This action cannot be undone.',
                function() {
                    showSuccess('Quiz deleted successfully!');
                    // Reload quizzes - check if we're in course view or section view
                    if (currentSection) {
                        loadSectionQuizzes(currentSection);
                    } else if (currentCourse) {
                        loadCourseQuizzes(currentCourse.id);
                    }
                }
            );
        }

        // Modal utility functions
        let confirmActionCallback = null;
        
        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            new bootstrap.Modal(document.getElementById('successModal')).show();
        }
        
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            new bootstrap.Modal(document.getElementById('errorModal')).show();
        }
        
        function showConfirm(message, details, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmDetails').textContent = details || '';
            confirmActionCallback = callback;
            new bootstrap.Modal(document.getElementById('confirmModal')).show();
        }
        
        function executeConfirmAction() {
            if (confirmActionCallback) {
                confirmActionCallback();
                confirmActionCallback = null;
            }
            bootstrap.Modal.getInstance(document.getElementById('confirmModal')).hide();
        }

        // Toggle quiz activation status
        function toggleQuizActivation(quizId) {
            // Find the quiz in the appropriate data structure
            let quiz = null;
            let found = false;
            
            // Search in section quizzes
            for (let sectionId in sectionQuizzes) {
                quiz = sectionQuizzes[sectionId].find(q => q.id === quizId);
                if (quiz) {
                    found = true;
                    break;
                }
            }
            
            if (found && quiz) {
                const action = quiz.isActivated ? 'deactivate' : 'activate';
                const actionText = quiz.isActivated ? 'deactivated' : 'activated';
                
                // Update toggle modal content
                document.getElementById('toggleActionTitle').textContent = action.charAt(0).toUpperCase() + action.slice(1) + ' Quiz';
                document.getElementById('toggleMessage').textContent = `Are you sure you want to ${action} this quiz?`;
                document.getElementById('toggleDetails').textContent = `Quiz: "${quiz.title}"`;
                document.getElementById('toggleQuizId').value = quizId;
                document.getElementById('toggleButtonText').textContent = action.charAt(0).toUpperCase() + action.slice(1);
                
                // Show the toggle modal
                new bootstrap.Modal(document.getElementById('toggleActivationModal')).show();
            }
        }
        
        function executeToggleActivation() {
            const quizId = parseInt(document.getElementById('toggleQuizId').value);
            let quiz = null;
            let found = false;
            
            // Search in section quizzes
            for (let sectionId in sectionQuizzes) {
                quiz = sectionQuizzes[sectionId].find(q => q.id === quizId);
                if (quiz) {
                    found = true;
                    break;
                }
            }
            
            if (found && quiz) {
                const actionText = quiz.isActivated ? 'deactivated' : 'activated';
                quiz.isActivated = !quiz.isActivated;
                
                // Hide the toggle modal
                bootstrap.Modal.getInstance(document.getElementById('toggleActivationModal')).hide();
                
                // Show success message
                showSuccess(`Quiz has been ${actionText} successfully!`);
                
                // Reload the quiz list to reflect changes
                if (currentSection) {
                    loadSectionQuizzes(currentSection);
                } else if (currentCourse) {
                    loadCourseQuizzes(currentCourse.id);
                }
            }
        }
        // Navigation functions
        function showCourseList() {
            document.getElementById('breadcrumb').innerHTML = `
                <li class="breadcrumb-item active">All Courses</li>
            `;
            
            document.getElementById('courseListView').classList.add('view-active');
            document.getElementById('courseSectionsView').classList.remove('view-active');
            document.getElementById('quizManagementView').classList.remove('view-active');
            document.getElementById('questionsManagementView').classList.remove('view-active');
            
            // Reset display styles
            document.getElementById('quizManagementView').style.display = 'none';
            document.getElementById('questionsManagementView').style.display = 'none';
            
            currentCourse = null;
            currentSection = null;
            currentQuiz = null;
        }

        function showCourseSections() {
            if (currentCourse) {
                showCourseSections(currentCourse);
            }
        }

        // Quiz management functions
        function viewQuiz(id) {
            // Find the quiz by ID
            let quiz = null;
            for (const sectionId in sectionQuizzes) {
                const found = sectionQuizzes[sectionId].find(q => q.id === id);
                if (found) {
                    quiz = found;
                    break;
                }
            }
            
            if (quiz) {
                // Populate the view modal
                document.getElementById('viewQuizTitle').textContent = quiz.title;
                document.getElementById('viewQuizDescription').textContent = quiz.description || 'No description provided.';
                document.getElementById('viewQuizQuestions').textContent = quiz.questions;
                document.getElementById('viewQuizDuration').textContent = quiz.duration;
                document.getElementById('viewQuizMaxAttempts').textContent = quiz.maxAttempts || 'Unlimited';
                document.getElementById('viewQuizType').textContent = quiz.type.charAt(0).toUpperCase() + quiz.type.slice(1);
                document.getElementById('viewQuizCreated').textContent = quiz.created;
                document.getElementById('viewQuizSection').textContent = quiz.section || 'Unknown Section';
                
                // Set schedule information
                const startDateTime = `${quiz.startDate} ${quiz.startTime}`;
                const endDateTime = `${quiz.endDate} ${quiz.endTime}`;
                document.getElementById('viewQuizStartDateTime').textContent = startDateTime;
                document.getElementById('viewQuizEndDateTime').textContent = endDateTime;
                
                // Set activation status
                const activationElement = document.getElementById('viewQuizActivation');
                if (quiz.isActivated) {
                    activationElement.textContent = 'Active';
                    activationElement.className = 'h6 mb-1 text-success';
                } else {
                    activationElement.textContent = 'Inactive';
                    activationElement.className = 'h6 mb-1 text-danger';
                }
                
                // Set status badge
                const statusBadge = document.getElementById('viewQuizStatus');
                const statusClass = quiz.status === 'active' ? 'bg-success' : quiz.status === 'draft' ? 'bg-warning' : 'bg-secondary';
                statusBadge.className = `badge ${statusClass}`;
                statusBadge.textContent = quiz.status.charAt(0).toUpperCase() + quiz.status.slice(1);
                
                // Store quiz ID for potential edit action
                window.currentViewQuizId = id;
                
                // Show the modal
                new bootstrap.Modal(document.getElementById('viewQuizModal')).show();
            }
        }

        function editQuiz(id) {
            // Find the quiz by ID
            let quiz = null;
            for (const sectionId in sectionQuizzes) {
                const found = sectionQuizzes[sectionId].find(q => q.id === id);
                if (found) {
                    quiz = found;
                    break;
                }
            }
            
            if (quiz) {
                // Populate the edit modal
                document.getElementById('editQuizId').value = quiz.id;
                document.getElementById('editQuizTitle').value = quiz.title;
                document.getElementById('editQuizDuration').value = quiz.duration;
                document.getElementById('editQuizDescription').value = quiz.description || '';
                document.getElementById('editQuizQuestions').value = quiz.questions;
                document.getElementById('editQuizStatus').value = quiz.status;
                document.getElementById('editQuizType').value = quiz.type;
                
                // Populate new fields
                document.getElementById('editQuizStartDate').value = quiz.startDate || '';
                document.getElementById('editQuizStartTime').value = quiz.startTime || '';
                document.getElementById('editQuizEndDate').value = quiz.endDate || '';
                document.getElementById('editQuizEndTime').value = quiz.endTime || '';
                document.getElementById('editQuizMaxAttempts').value = quiz.maxAttempts || 3;
                document.getElementById('editQuizIsActivated').checked = quiz.isActivated !== false;
                
                // Show the modal
                new bootstrap.Modal(document.getElementById('editQuizModal')).show();
            }
        }

        function editQuizFromView() {
            // Close view modal and open edit modal
            bootstrap.Modal.getInstance(document.getElementById('viewQuizModal')).hide();
            setTimeout(() => {
                editQuiz(window.currentViewQuizId);
            }, 300);
        }

        function updateQuiz() {
            const form = document.getElementById('editQuizForm');
            if (form.checkValidity()) {
                const quizId = document.getElementById('editQuizId').value;
                const updatedData = {
                    title: document.getElementById('editQuizTitle').value,
                    duration: document.getElementById('editQuizDuration').value,
                    description: document.getElementById('editQuizDescription').value,
                    questions: document.getElementById('editQuizQuestions').value,
                    status: document.getElementById('editQuizStatus').value,
                    type: document.getElementById('editQuizType').value
                };
                
                // In a real app, you would send this data to the server
                console.log('Updating quiz:', quizId, updatedData);
                
                showSuccess('Quiz updated successfully!');
                bootstrap.Modal.getInstance(document.getElementById('editQuizModal')).hide();
                
                // Reload quizzes
                if (currentSection) {
                    loadSectionQuizzes(currentSection);
                } else if (currentCourse) {
                    loadCourseQuizzes(currentCourse.id);
                }
            } else {
                form.reportValidity();
            }
        }

        function deleteQuiz(id) {
            // Find the quiz by ID
            let quiz = null;
            for (const sectionId in sectionQuizzes) {
                const found = sectionQuizzes[sectionId].find(q => q.id === id);
                if (found) {
                    quiz = found;
                    break;
                }
            }
            
            if (quiz) {
                // Populate the delete modal
                document.getElementById('deleteQuizId').value = quiz.id;
                document.getElementById('deleteQuizTitle').textContent = quiz.title;
                
                // Show the modal
                new bootstrap.Modal(document.getElementById('deleteQuizModal')).show();
            }
        }

        function confirmDeleteQuiz() {
            const quizId = document.getElementById('deleteQuizId').value;
            
            // In a real app, you would send a delete request to the server
            console.log('Deleting quiz:', quizId);
            
            showSuccess('Quiz deleted successfully!');
            bootstrap.Modal.getInstance(document.getElementById('deleteQuizModal')).hide();
            
            // Reload quizzes
            if (currentSection) {
                loadSectionQuizzes(currentSection);
            } else if (currentCourse) {
                loadCourseQuizzes(currentCourse.id);
            }
        }

        // Questions Management Functions
        function manageQuestions() {
            if (window.currentViewQuizId) {
                manageQuestionsForQuiz(window.currentViewQuizId);
                bootstrap.Modal.getInstance(document.getElementById('viewQuizModal')).hide();
            }
        }

        function manageQuestionsForQuiz(quizId) {
            // Find the quiz
            let quiz = null;
            for (const sectionId in sectionQuizzes) {
                const found = sectionQuizzes[sectionId].find(q => q.id === quizId);
                if (found) {
                    quiz = found;
                    break;
                }
            }

            if (quiz) {
                currentQuiz = quiz;
                
                // Update header
                document.getElementById('questionsQuizTitle').textContent = quiz.title;
                document.getElementById('questionsQuizInfo').textContent = `${quiz.type.charAt(0).toUpperCase() + quiz.type.slice(1)}  ${quiz.duration} minutes  ${quiz.section}`;
                
                // Update breadcrumb
                if (currentCourse) {
                    document.getElementById('breadcrumb').innerHTML = `
                        <li class="breadcrumb-item"><a href="javascript:void(0)" onclick="showCourseList()">All Courses</a></li>
                        <li class="breadcrumb-item"><a href="javascript:void(0)" onclick="backToQuizManagement()">${currentCourse.name} - Quiz Management</a></li>
                        <li class="breadcrumb-item active">${quiz.title} - Questions</li>
                    `;
                }
                
                // Load questions
                loadQuestions(quizId);
                
                // Hide quiz management, show questions management
                document.getElementById('quizManagementView').classList.remove('view-active');
                document.getElementById('quizManagementView').style.display = 'none';
                document.getElementById('questionsManagementView').classList.add('view-active');
                document.getElementById('questionsManagementView').style.display = 'block';
            }
        }

        function backToQuizManagement() {
            // Hide questions management view
            document.getElementById('questionsManagementView').classList.remove('view-active');
            document.getElementById('questionsManagementView').style.display = 'none';
            
            // Show quiz management view
            document.getElementById('quizManagementView').classList.add('view-active');
            document.getElementById('quizManagementView').style.display = 'block';
            
            // Update breadcrumb
            if (currentCourse) {
                document.getElementById('breadcrumb').innerHTML = `
                    <li class="breadcrumb-item"><a href="javascript:void(0)" onclick="showCourseList()">All Courses</a></li>
                    <li class="breadcrumb-item active">${currentCourse.name} - Quiz Management</li>
                `;
            }
            
            // Clear current quiz
            currentQuiz = null;
        }

        function loadQuestions(quizId) {
            const tableBody = document.getElementById('questionsTableBody');
            tableBody.innerHTML = '';
            
            const questions = quizQuestions[quizId] || [];
            
            if (questions.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">
                            <i class="fas fa-question-circle fa-2x mb-2 d-block"></i>
                            No questions found. Click "Add Question" to create some.
                        </td>
                    </tr>
                `;
                return;
            }
            
            questions.forEach((question, index) => {
                const row = document.createElement('tr');
                
                const typeClass = question.type === 'multiple-choice' ? 'primary' : 
                                question.type === 'true-false' ? 'success' : 
                                question.type === 'short-answer' ? 'warning' : 'info';
                
                const difficultyClass = question.difficulty === 'easy' ? 'success' : 
                                      question.difficulty === 'medium' ? 'warning' : 'danger';
                
                row.innerHTML = `
                    <td><strong>${index + 1}</strong></td>
                    <td>
                        <div class="fw-bold mb-1">${question.text.substring(0, 80)}${question.text.length > 80 ? '...' : ''}</div>
                        <small class="text-muted">${question.explanation ? 'Has explanation' : 'No explanation'}</small>
                    </td>
                    <td><span class="badge bg-${typeClass}">${question.type.replace('-', ' ')}</span></td>
                    <td><span class="badge bg-secondary">${question.points}</span></td>
                    <td><span class="badge bg-${difficultyClass}">${question.difficulty}</span></td>
                    <td>
                        <button class="btn btn-sm-custom btn-outline-primary" onclick="viewQuestion(${question.id})" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm-custom btn-outline-warning" onclick="editQuestion(${question.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm-custom btn-outline-danger" onclick="deleteQuestion(${question.id}, ${index + 1})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function toggleAnswerFields() {
            const questionType = document.getElementById('questionType').value;
            const mcOptions = document.getElementById('multipleChoiceOptions');
            const tfOptions = document.getElementById('trueFalseOptions');
            const textOptions = document.getElementById('textAnswerOptions');
            
            // Hide all
            mcOptions.style.display = 'none';
            tfOptions.style.display = 'none';
            textOptions.style.display = 'none';
            
            // Show relevant
            if (questionType === 'multiple-choice') {
                mcOptions.style.display = 'block';
            } else if (questionType === 'true-false') {
                tfOptions.style.display = 'block';
            } else {
                textOptions.style.display = 'block';
            }
        }

        function toggleEditAnswerFields() {
            const questionType = document.getElementById('editQuestionType').value;
            const mcOptions = document.getElementById('editMultipleChoiceOptions');
            
            if (questionType === 'multiple-choice') {
                mcOptions.style.display = 'block';
            } else {
                mcOptions.style.display = 'none';
            }
        }

        function addQuestion() {
            const form = document.getElementById('addQuestionForm');
            if (form.checkValidity()) {
                // Collect form data
                const questionData = {
                    id: Date.now(), // Simple ID generation
                    text: document.getElementById('questionText').value,
                    type: document.getElementById('questionType').value,
                    points: parseInt(document.getElementById('questionPoints').value),
                    difficulty: document.getElementById('questionDifficulty').value,
                    explanation: document.getElementById('questionExplanation').value
                };

                // Handle different question types
                if (questionData.type === 'multiple-choice') {
                    questionData.options = {
                        A: document.getElementById('optionA').value,
                        B: document.getElementById('optionB').value,
                        C: document.getElementById('optionC').value,
                        D: document.getElementById('optionD').value
                    };
                    questionData.correctAnswer = document.querySelector('input[name="correctAnswer"]:checked').value;
                } else if (questionData.type === 'true-false') {
                    questionData.correctAnswer = document.querySelector('input[name="tfAnswer"]:checked').value;
                } else {
                    questionData.correctAnswer = document.getElementById('correctAnswer').value;
                }

                // Add to questions array (in real app, send to server)
                if (!quizQuestions[currentQuiz.id]) {
                    quizQuestions[currentQuiz.id] = [];
                }
                quizQuestions[currentQuiz.id].push(questionData);

                showSuccess('Question added successfully!');
                bootstrap.Modal.getInstance(document.getElementById('addQuestionModal')).hide();
                form.reset();
                loadQuestions(currentQuiz.id);
            } else {
                form.reportValidity();
            }
        }

        function viewQuestion(questionId) {
            // Find the question
            const questions = quizQuestions[currentQuiz.id] || [];
            const question = questions.find(q => q.id === questionId);
            
            if (question) {
                // Populate view modal
                document.getElementById('viewQuestionText').textContent = question.text;
                document.getElementById('viewQuestionType').textContent = question.type.replace('-', ' ');
                document.getElementById('viewQuestionPoints').textContent = question.points;
                document.getElementById('viewQuestionDifficulty').textContent = question.difficulty;
                
                const questionIndex = questions.findIndex(q => q.id === questionId) + 1;
                document.getElementById('viewQuestionNumber').textContent = questionIndex;
                
                // Show options based on type
                const optionsDiv = document.getElementById('viewQuestionOptions');
                if (question.type === 'multiple-choice') {
                    optionsDiv.innerHTML = `
                        <h6>Options:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-2 ${question.correctAnswer === 'A' ? 'text-success fw-bold' : ''}">
                                    A. ${question.options.A}
                                </div>
                                <div class="mb-2 ${question.correctAnswer === 'B' ? 'text-success fw-bold' : ''}">
                                    B. ${question.options.B}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-2 ${question.correctAnswer === 'C' ? 'text-success fw-bold' : ''}">
                                    C. ${question.options.C}
                                </div>
                                <div class="mb-2 ${question.correctAnswer === 'D' ? 'text-success fw-bold' : ''}">
                                    D. ${question.options.D}
                                </div>
                            </div>
                        </div>
                    `;
                } else if (question.type === 'true-false') {
                    optionsDiv.innerHTML = `
                        <h6>Correct Answer:</h6>
                        <div class="badge bg-success">${question.correctAnswer === 'true' ? 'True' : 'False'}</div>
                    `;
                } else {
                    optionsDiv.innerHTML = `
                        <h6>Sample Answer:</h6>
                        <div class="alert alert-light">${question.correctAnswer || 'No sample answer provided'}</div>
                    `;
                }
                
                // Show explanation if available
                const explanationDiv = document.getElementById('viewQuestionExplanation');
                if (question.explanation) {
                    document.getElementById('explanationText').textContent = question.explanation;
                    explanationDiv.style.display = 'block';
                } else {
                    explanationDiv.style.display = 'none';
                }
                
                window.currentViewQuestionId = questionId;
                new bootstrap.Modal(document.getElementById('viewQuestionModal')).show();
            }
        }

        function editQuestion(questionId) {
            // Find the question
            const questions = quizQuestions[currentQuiz.id] || [];
            const question = questions.find(q => q.id === questionId);
            
            if (question) {
                // Populate edit form
                document.getElementById('editQuestionId').value = question.id;
                document.getElementById('editQuestionText').value = question.text;
                document.getElementById('editQuestionType').value = question.type;
                document.getElementById('editQuestionPoints').value = question.points;
                document.getElementById('editQuestionDifficulty').value = question.difficulty;
                document.getElementById('editQuestionExplanation').value = question.explanation || '';
                
                // Handle multiple choice options
                if (question.type === 'multiple-choice') {
                    document.getElementById('editOptionA').value = question.options.A;
                    document.getElementById('editOptionB').value = question.options.B;
                    document.getElementById('editOptionC').value = question.options.C;
                    document.getElementById('editOptionD').value = question.options.D;
                    document.querySelector(`input[name="editCorrectAnswer"][value="${question.correctAnswer}"]`).checked = true;
                }
                
                toggleEditAnswerFields();
                new bootstrap.Modal(document.getElementById('editQuestionModal')).show();
            }
        }

        function editQuestionFromView() {
            bootstrap.Modal.getInstance(document.getElementById('viewQuestionModal')).hide();
            setTimeout(() => {
                editQuestion(window.currentViewQuestionId);
            }, 300);
        }

        function updateQuestion() {
            const form = document.getElementById('editQuestionForm');
            if (form.checkValidity()) {
                const questionId = parseInt(document.getElementById('editQuestionId').value);
                const questions = quizQuestions[currentQuiz.id] || [];
                const questionIndex = questions.findIndex(q => q.id === questionId);
                
                if (questionIndex !== -1) {
                    // Update question data
                    questions[questionIndex] = {
                        ...questions[questionIndex],
                        text: document.getElementById('editQuestionText').value,
                        type: document.getElementById('editQuestionType').value,
                        points: parseInt(document.getElementById('editQuestionPoints').value),
                        difficulty: document.getElementById('editQuestionDifficulty').value,
                        explanation: document.getElementById('editQuestionExplanation').value
                    };

                    // Handle multiple choice options
                    if (questions[questionIndex].type === 'multiple-choice') {
                        questions[questionIndex].options = {
                            A: document.getElementById('editOptionA').value,
                            B: document.getElementById('editOptionB').value,
                            C: document.getElementById('editOptionC').value,
                            D: document.getElementById('editOptionD').value
                        };
                        questions[questionIndex].correctAnswer = document.querySelector('input[name="editCorrectAnswer"]:checked').value;
                    }

                    showSuccess('Question updated successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('editQuestionModal')).hide();
                    loadQuestions(currentQuiz.id);
                }
            } else {
                form.reportValidity();
            }
        }

        function deleteQuestion(questionId, questionNumber) {
            document.getElementById('deleteQuestionId').value = questionId;
            document.getElementById('deleteQuestionNumber').textContent = questionNumber;
            new bootstrap.Modal(document.getElementById('deleteQuestionModal')).show();
        }

        function confirmDeleteQuestion() {
            const questionId = parseInt(document.getElementById('deleteQuestionId').value);
            const questions = quizQuestions[currentQuiz.id] || [];
            const questionIndex = questions.findIndex(q => q.id === questionId);
            
            if (questionIndex !== -1) {
                questions.splice(questionIndex, 1);
                showSuccess('Question deleted successfully!');
                bootstrap.Modal.getInstance(document.getElementById('deleteQuestionModal')).hide();
                loadQuestions(currentQuiz.id);
            }
        }

        function previewQuiz() {
            const questions = quizQuestions[currentQuiz.id] || [];
            if (questions.length === 0) {
                showError('No questions found. Please add some questions first.');
                return;
            }
            
            const totalPoints = questions.reduce((sum, q) => sum + q.points, 0);
            const previewMessage = `Quiz Preview\n\nTitle: ${currentQuiz.title}\n\nQuestions: ${questions.length}\n\nTotal Points: ${totalPoints}\n\nDuration: ${currentQuiz.duration} minutes\n\nThis would open a preview of the quiz for students.`;
            
            showSuccess(previewMessage);
        }

        function viewQuizSubmissions() {
            // Navigate to the Quiz Submissions page
            window.location.href = 'QuizSubmissions.html';
        }
    </script>
</body>
</html>