<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - Learning Management System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../css/bootstrap-5.2.3-dist/css/bootstrap.css">
    <script src="../../css/bootstrap-5.2.3-dist/js/bootstrap.js"></script>
    <link rel="stylesheet" href="../../css/fontawesome-free-6.7.2-web/css/all.css">
    <!-- jsPDF and jsPDF-AutoTable for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .container {
            max-width: 1200px;
        }

        .page-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .page-title {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-subtitle {
            color: #7f8c8d;
            margin-bottom: 0;
        }

        .report-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        .report-title {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-description {
            color: #7f8c8d;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .export-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .export-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
            justify-content: center;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #2980b9, #3498db);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
            border: none;
        }

        .btn-info:hover {
            background: linear-gradient(45deg, #138496, #17a2b8);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            border: none;
        }

        .btn-warning:hover {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            color: white;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            text-decoration: none;
            transform: translateX(-5px);
        }

        .stats-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            flex: 1;
            min-width: 200px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-weight: 500;
        }

        .filter-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .filter-title {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .form-select, .form-control {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 10px 15px;
        }

        .form-select:focus, .form-control:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .modal-content {
            border-radius: 15px;
            border: none;
        }

        .modal-header {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .btn-close {
            filter: brightness(0) invert(1);
        }

        @media (max-width: 768px) {
            .export-options {
                flex-direction: column;
            }
            
            .export-btn {
                width: 100%;
            }
            
            .stats-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="AdminMaster.html" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
        </a>

        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-chart-bar"></i>
                Reports & Export
            </h1>
            <p class="page-subtitle">Generate and export comprehensive PDF reports for users, courses, and quizzes</p>
        </div>

        <!-- Statistics Overview -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-number" id="totalStudents">245</div>
                <div class="stat-label">Total Students</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTeachers">18</div>
                <div class="stat-label">Total Teachers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCourses">12</div>
                <div class="stat-label">Active Courses</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalQuizzes">48</div>
                <div class="stat-label">Total Quizzes</div>
            </div>
        </div>

        <!-- User Reports -->
        <div class="report-card">
            <h3 class="report-title">
                <i class="fas fa-users"></i>
                User Reports
            </h3>
            <p class="report-description">
                Export comprehensive PDF lists of students and teachers with their profile information, registration dates, and activity status.
            </p>
            
            <div class="filter-section">
                <h6 class="filter-title">Filter Options</h6>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">User Type</label>
                        <select class="form-select" id="userTypeFilter">
                            <option value="all">All Users</option>
                            <option value="students">Students Only</option>
                            <option value="teachers">Teachers Only</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="userStatusFilter">
                            <option value="all">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Registration Date</label>
                        <select class="form-select" id="userDateFilter">
                            <option value="all">All Time</option>
                            <option value="thisMonth">This Month</option>
                            <option value="lastMonth">Last Month</option>
                            <option value="thisYear">This Year</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="export-options">
                <button class="export-btn btn-primary" onclick="exportUsers('students')">
                    <i class="fas fa-file-pdf"></i>
                    Export Students PDF
                </button>
                <button class="export-btn btn-success" onclick="exportUsers('teachers')">
                    <i class="fas fa-file-pdf"></i>
                    Export Teachers PDF
                </button>
                <button class="export-btn btn-info" onclick="exportUsers('all')">
                    <i class="fas fa-file-pdf"></i>
                    Export All Users PDF
                </button>
            </div>
        </div>

        <!-- Quiz Reports -->
        <div class="report-card">
            <h3 class="report-title">
                <i class="fas fa-clipboard-list"></i>
                Quiz Reports
            </h3>
            <p class="report-description">
                Export detailed PDF quiz reports including questions, submissions, and performance analytics by course and level.
            </p>
            
            <div class="filter-section">
                <h6 class="filter-title">Filter Options</h6>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Course</label>
                        <select class="form-select" id="quizCourseFilter">
                            <option value="all">All Courses</option>
                            <option value="intro-cs">Introduction to Computer Science</option>
                            <option value="data-structures">Data Structures</option>
                            <option value="algorithms">Algorithms</option>
                            <option value="web-dev">Web Development</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Level</label>
                        <select class="form-select" id="quizLevelFilter">
                            <option value="all">All Levels</option>
                            <option value="level100">Level 100</option>
                            <option value="level200">Level 200</option>
                            <option value="level300">Level 300</option>
                            <option value="level400">Level 400</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Quiz Type</label>
                        <select class="form-select" id="quizTypeFilter">
                            <option value="all">All Types</option>
                            <option value="assessment">Assessment</option>
                            <option value="practice">Practice</option>
                            <option value="exam">Exam</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="export-options">
                <button class="export-btn btn-primary" onclick="exportQuizzes('basic')">
                    <i class="fas fa-file-pdf"></i>
                    Basic Quiz PDF
                </button>
                <button class="export-btn btn-success" onclick="exportQuizzes('detailed')">
                    <i class="fas fa-file-pdf"></i>
                    Detailed PDF
                </button>
                <button class="export-btn btn-warning" onclick="exportQuizzes('submissions')">
                    <i class="fas fa-file-pdf"></i>
                    With Submissions PDF
                </button>
                <button class="export-btn btn-info" onclick="exportQuizzes('analytics')">
                    <i class="fas fa-file-pdf"></i>
                    Analytics PDF
                </button>
            </div>
        </div>

        <!-- Course Reports -->
        <div class="report-card">
            <h3 class="report-title">
                <i class="fas fa-book"></i>
                Course Reports
            </h3>
            <p class="report-description">
                Export PDF course enrollment data, teacher assignments, and student registration lists with detailed information.
            </p>
            
            <div class="filter-section">
                <h6 class="filter-title">Filter Options</h6>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Academic Year</label>
                        <select class="form-select" id="courseYearFilter">
                            <option value="2024-2025">2024-2025</option>
                            <option value="2023-2024">2023-2024</option>
                            <option value="2022-2023">2022-2023</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Semester</label>
                        <select class="form-select" id="courseSemesterFilter">
                            <option value="all">All Semesters</option>
                            <option value="first">First Semester</option>
                            <option value="second">Second Semester</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Department</label>
                        <select class="form-select" id="courseDepartmentFilter">
                            <option value="all">All Departments</option>
                            <option value="cs">Computer Science</option>
                            <option value="it">Information Technology</option>
                            <option value="math">Mathematics</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="export-options">
                <button class="export-btn btn-primary" onclick="exportCourses('student-enrollment')">
                    <i class="fas fa-file-pdf"></i>
                    Student Enrollments PDF
                </button>
                <button class="export-btn btn-success" onclick="exportCourses('teacher-assignments')">
                    <i class="fas fa-file-pdf"></i>
                    Teacher Assignments PDF
                </button>
                <button class="export-btn btn-info" onclick="exportCourses('course-details')">
                    <i class="fas fa-file-pdf"></i>
                    Course Details PDF
                </button>
                <button class="export-btn btn-warning" onclick="exportCourses('enrollment-stats')">
                    <i class="fas fa-file-pdf"></i>
                    Enrollment Stats PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">
                        <i class="fas fa-check-circle"></i> Export Successful
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="successModalBody">
                    Your export has been completed successfully!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h5 class="modal-title text-white" id="errorModalLabel">
                        <i class="fas fa-exclamation-triangle"></i> Export Error
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="errorModalBody">
                    An error occurred during export.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" aria-labelledby="loadingModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3 mb-0">Generating export...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data for demonstration
        const sampleData = {
            students: [
                { id: 1, name: "John Doe", email: "john.doe@student.uew.edu.gh", program: "Computer Science", level: "200", status: "Active", registrationDate: "2024-01-15" },
                { id: 2, name: "Jane Smith", email: "jane.smith@student.uew.edu.gh", program: "Information Technology", level: "300", status: "Active", registrationDate: "2024-01-20" },
                { id: 3, name: "Michael Johnson", email: "michael.johnson@student.uew.edu.gh", program: "Computer Science", level: "100", status: "Active", registrationDate: "2024-02-01" },
                { id: 4, name: "Sarah Williams", email: "sarah.williams@student.uew.edu.gh", program: "Mathematics", level: "400", status: "Active", registrationDate: "2024-01-10" },
                { id: 5, name: "David Brown", email: "david.brown@student.uew.edu.gh", program: "Computer Science", level: "200", status: "Inactive", registrationDate: "2023-12-15" }
            ],
            teachers: [
                { id: 1, name: "Dr. Robert Anderson", email: "robert.anderson@uew.edu.gh", department: "Computer Science", specialization: "Software Engineering", status: "Active", hireDate: "2020-08-15" },
                { id: 2, name: "Prof. Mary Johnson", email: "mary.johnson@uew.edu.gh", department: "Information Technology", specialization: "Database Systems", status: "Active", hireDate: "2018-09-01" },
                { id: 3, name: "Dr. James Wilson", email: "james.wilson@uew.edu.gh", department: "Computer Science", specialization: "Algorithms", status: "Active", hireDate: "2019-02-10" },
                { id: 4, name: "Dr. Lisa Davis", email: "lisa.davis@uew.edu.gh", department: "Mathematics", specialization: "Statistics", status: "Active", hireDate: "2021-01-20" }
            ],
            courses: [
                { id: 1, name: "Introduction to Computer Science", code: "CS101", level: "100", teacher: "Dr. Robert Anderson", enrolled: 45, department: "Computer Science" },
                { id: 2, name: "Programming Basics", code: "CS102", level: "200", teacher: "Dr. Robert Anderson", enrolled: 38, department: "Computer Science" },
                { id: 3, name: "Data Structures", code: "CS201", level: "200", teacher: "Dr. James Wilson", enrolled: 32, department: "Computer Science" },
                { id: 4, name: "Database Systems", code: "IT301", level: "300", teacher: "Prof. Mary Johnson", enrolled: 28, department: "Information Technology" },
                { id: 5, name: "Web Development", code: "CS302", level: "300", teacher: "Dr. Robert Anderson", enrolled: 35, department: "Computer Science" }
            ],
            quizzes: [
                { id: 1, title: "Programming Basics Quiz", course: "Introduction to Computer Science", level: "200", questions: 15, submissions: 42, avgScore: 78.5 },
                { id: 2, title: "Variables and Data Types", course: "Programming Basics", level: "200", questions: 10, submissions: 35, avgScore: 82.3 },
                { id: 3, title: "Algorithms Fundamentals", course: "Data Structures", level: "200", questions: 20, submissions: 30, avgScore: 75.8 },
                { id: 4, title: "SQL Basics", course: "Database Systems", level: "300", questions: 12, submissions: 25, avgScore: 80.2 }
            ]
        };

        // Modal functions
        function showSuccess(message) {
            document.getElementById('successModalBody').textContent = message;
            new bootstrap.Modal(document.getElementById('successModal')).show();
        }

        function showError(message) {
            document.getElementById('errorModalBody').textContent = message;
            new bootstrap.Modal(document.getElementById('errorModal')).show();
        }

        function showLoading() {
            new bootstrap.Modal(document.getElementById('loadingModal')).show();
        }

        function hideLoading() {
            bootstrap.Modal.getInstance(document.getElementById('loadingModal'))?.hide();
        }

        // Export functions
        function exportUsers(type) {
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                
                const userType = document.getElementById('userTypeFilter').value;
                const status = document.getElementById('userStatusFilter').value;
                const dateFilter = document.getElementById('userDateFilter').value;
                
                let data = [];
                if (type === 'students' || (type === 'all' && (userType === 'all' || userType === 'students'))) {
                    data = data.concat(sampleData.students);
                }
                if (type === 'teachers' || (type === 'all' && (userType === 'all' || userType === 'teachers'))) {
                    data = data.concat(sampleData.teachers);
                }
                
                // Apply filters
                if (status !== 'all') {
                    data = data.filter(user => user.status.toLowerCase() === status);
                }
                
                generateUsersPDF(data, type);
                
                showSuccess(`${type.charAt(0).toUpperCase() + type.slice(1)} report exported successfully! ${data.length} records exported.`);
            }, 2000);
        }

        function exportQuizzes(reportType) {
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                
                const course = document.getElementById('quizCourseFilter').value;
                const level = document.getElementById('quizLevelFilter').value;
                const type = document.getElementById('quizTypeFilter').value;
                
                let data = [...sampleData.quizzes];
                
                // Apply filters
                if (course !== 'all') {
                    data = data.filter(quiz => quiz.course.toLowerCase().includes(course.replace('-', ' ')));
                }
                if (level !== 'all') {
                    data = data.filter(quiz => quiz.level === level.replace('level', ''));
                }
                
                generateQuizzesPDF(data, reportType);
                
                showSuccess(`Quiz ${reportType} report exported successfully! ${data.length} quizzes exported.`);
            }, 2000);
        }

        function exportCourses(reportType) {
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                
                const year = document.getElementById('courseYearFilter').value;
                const semester = document.getElementById('courseSemesterFilter').value;
                const department = document.getElementById('courseDepartmentFilter').value;
                
                let data = [];
                
                switch(reportType) {
                    case 'student-enrollment':
                        // Generate student-course enrollment data
                        data = sampleData.students.flatMap(student => 
                            sampleData.courses.map(course => ({
                                studentName: student.name,
                                studentEmail: student.email,
                                courseName: course.name,
                                courseCode: course.code,
                                teacher: course.teacher,
                                enrollmentDate: "2024-01-15"
                            }))
                        ).slice(0, 50); // Limit for demo
                        break;
                    case 'teacher-assignments':
                        // Generate teacher-course assignment data
                        data = sampleData.teachers.flatMap(teacher => 
                            sampleData.courses.filter(course => course.teacher === teacher.name).map(course => ({
                                teacherName: teacher.name,
                                teacherEmail: teacher.email,
                                department: teacher.department,
                                courseName: course.name,
                                courseCode: course.code,
                                enrolled: course.enrolled
                            }))
                        );
                        break;
                    case 'course-details':
                        data = sampleData.courses;
                        break;
                    case 'enrollment-stats':
                        data = sampleData.courses.map(course => ({
                            ...course,
                            enrollmentRate: Math.round((course.enrolled / 50) * 100) + '%',
                            capacity: 50,
                            available: 50 - course.enrolled
                        }));
                        break;
                }
                
                // Apply filters
                if (department !== 'all') {
                    data = data.filter(item => 
                        item.department?.toLowerCase().includes(department) || 
                        item.courseName?.toLowerCase().includes(department)
                    );
                }
                
                generateCoursesPDF(data, reportType);
                
                showSuccess(`Course ${reportType.replace('-', ' ')} report exported successfully! ${data.length} records exported.`);
            }, 2000);
        }

        // PDF Generation Functions
        function generateUsersPDF(data, type) {
            try {
                const { jsPDF } = window.jspdf;
                
                if (!jsPDF) {
                    showError('PDF library not loaded. Please refresh the page and try again.');
                    return;
                }
                
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Add header
                addPDFHeader(doc, `${type.charAt(0).toUpperCase() + type.slice(1)} Report`);
                
                // Prepare table data
                let headers, rows;
                
                if (type === 'students' || (type === 'all' && data.some(item => item.program))) {
                    headers = ['Name', 'Email', 'Program', 'Level', 'Status', 'Registration Date'];
                    rows = data.filter(item => item.program).map(student => [
                        student.name || 'N/A',
                        student.email || 'N/A',
                        student.program || 'N/A',
                        student.level || 'N/A',
                        student.status || 'N/A',
                        student.registrationDate || 'N/A'
                    ]);
                } else {
                    headers = ['Name', 'Email', 'Department', 'Specialization', 'Status', 'Hire Date'];
                    rows = data.filter(item => item.department).map(teacher => [
                        teacher.name || 'N/A',
                        teacher.email || 'N/A',
                        teacher.department || 'N/A',
                        teacher.specialization || 'N/A',
                        teacher.status || 'N/A',
                        teacher.hireDate || 'N/A'
                    ]);
                }
                
                if (rows.length === 0) {
                    showError('No data available for the selected filters.');
                    return;
                }
                
                // Add table
                doc.autoTable({
                    head: [headers],
                    body: rows,
                    startY: 50,
                    theme: 'striped',
                    headStyles: {
                        fillColor: [52, 152, 219],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    styles: {
                        fontSize: 9,
                        cellPadding: 3
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    }
                });
                
                // Add footer
                addPDFFooter(doc);
                
                // Save the PDF
                const filename = `${type}_report_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
                
            } catch (error) {
                console.error('PDF Generation Error:', error);
                showError('Failed to generate PDF. Error: ' + error.message);
            }
        }

        function generateQuizzesPDF(data, reportType) {
            try {
                const { jsPDF } = window.jspdf;
                
                if (!jsPDF) {
                    showError('PDF library not loaded. Please refresh the page and try again.');
                    return;
                }
                
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Add header
                addPDFHeader(doc, `Quiz ${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report`);
                
                // Prepare table data based on report type
                let headers, rows;
                
                switch(reportType) {
                    case 'basic':
                        headers = ['Title', 'Course', 'Level', 'Questions'];
                        rows = data.map(quiz => [
                            quiz.title || 'N/A',
                            quiz.course || 'N/A',
                            quiz.level || 'N/A',
                            (quiz.questions || 0).toString()
                        ]);
                        break;
                    case 'detailed':
                        headers = ['Title', 'Course', 'Level', 'Questions', 'Type'];
                        rows = data.map(quiz => [
                            quiz.title || 'N/A',
                            quiz.course || 'N/A',
                            quiz.level || 'N/A',
                            (quiz.questions || 0).toString(),
                            'Assessment'
                        ]);
                        break;
                    case 'submissions':
                        headers = ['Title', 'Course', 'Questions', 'Submissions', 'Avg Score'];
                        rows = data.map(quiz => [
                            quiz.title || 'N/A',
                            quiz.course || 'N/A',
                            (quiz.questions || 0).toString(),
                            (quiz.submissions || 0).toString(),
                            (quiz.avgScore || 0).toFixed(1) + '%'
                        ]);
                        break;
                    case 'analytics':
                        headers = ['Title', 'Course', 'Submissions', 'Avg Score', 'Performance'];
                        rows = data.map(quiz => [
                            quiz.title || 'N/A',
                            quiz.course || 'N/A',
                            (quiz.submissions || 0).toString(),
                            (quiz.avgScore || 0).toFixed(1) + '%',
                            (quiz.avgScore || 0) >= 80 ? 'Excellent' : (quiz.avgScore || 0) >= 70 ? 'Good' : 'Needs Improvement'
                        ]);
                        break;
                }
                
                if (rows.length === 0) {
                    showError('No quiz data available for the selected filters.');
                    return;
                }
                
                // Add table
                doc.autoTable({
                    head: [headers],
                    body: rows,
                    startY: 50,
                    theme: 'striped',
                    headStyles: {
                        fillColor: [52, 152, 219],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    styles: {
                        fontSize: 9,
                        cellPadding: 3
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    }
                });
                
                // Add footer
                addPDFFooter(doc);
                
                // Save the PDF
                const filename = `quiz_${reportType}_report_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
                
            } catch (error) {
                console.error('PDF Generation Error:', error);
                showError('Failed to generate PDF. Error: ' + error.message);
            }
        }

        function generateCoursesPDF(data, reportType) {
            try {
                const { jsPDF } = window.jspdf;
                
                if (!jsPDF) {
                    showError('PDF library not loaded. Please refresh the page and try again.');
                    return;
                }
                
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Add header
                addPDFHeader(doc, `Course ${reportType.replace('-', ' ').charAt(0).toUpperCase() + reportType.replace('-', ' ').slice(1)} Report`);
                
                // Prepare table data based on report type
                let headers, rows;
                
                switch(reportType) {
                    case 'student-enrollment':
                        headers = ['Student Name', 'Email', 'Course', 'Code', 'Teacher'];
                        rows = data.map(enrollment => [
                            enrollment.studentName || 'N/A',
                            enrollment.studentEmail || 'N/A',
                            enrollment.courseName || 'N/A',
                            enrollment.courseCode || 'N/A',
                            enrollment.teacher || 'N/A'
                        ]);
                        break;
                    case 'teacher-assignments':
                        headers = ['Teacher', 'Email', 'Department', 'Course', 'Enrolled'];
                        rows = data.map(assignment => [
                            assignment.teacherName || 'N/A',
                            assignment.teacherEmail || 'N/A',
                            assignment.department || 'N/A',
                            assignment.courseName || 'N/A',
                            (assignment.enrolled || 0).toString()
                        ]);
                        break;
                    case 'course-details':
                        headers = ['Course Name', 'Code', 'Level', 'Teacher', 'Enrolled', 'Department'];
                        rows = data.map(course => [
                            course.name || 'N/A',
                            course.code || 'N/A',
                            course.level || 'N/A',
                            course.teacher || 'N/A',
                            (course.enrolled || 0).toString(),
                            course.department || 'N/A'
                        ]);
                        break;
                    case 'enrollment-stats':
                        headers = ['Course', 'Code', 'Enrolled', 'Capacity', 'Rate', 'Available'];
                        rows = data.map(stats => [
                            stats.name || 'N/A',
                            stats.code || 'N/A',
                            (stats.enrolled || 0).toString(),
                            (stats.capacity || 0).toString(),
                            stats.enrollmentRate || '0%',
                            (stats.available || 0).toString()
                        ]);
                        break;
                }
                
                if (rows.length === 0) {
                    showError('No course data available for the selected filters.');
                    return;
                }
                
                // Add table
                doc.autoTable({
                    head: [headers],
                    body: rows,
                    startY: 50,
                    theme: 'striped',
                    headStyles: {
                        fillColor: [52, 152, 219],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    styles: {
                        fontSize: 8,
                        cellPadding: 2
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    }
                });
                
                // Add footer
                addPDFFooter(doc);
                
                // Save the PDF
                const filename = `course_${reportType}_report_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
                
            } catch (error) {
                console.error('PDF Generation Error:', error);
                showError('Failed to generate PDF. Error: ' + error.message);
            }
        }

        function addPDFHeader(doc, title) {
            try {
                // Add UEW logo area (placeholder)
                doc.setFillColor(52, 152, 219);
                doc.rect(15, 10, 180, 20, 'F');
                
                // Add title
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('University of Education, Winneba', 20, 18);
                doc.setFontSize(12);
                doc.text('Learning Management System', 20, 25);
                
                // Add report title
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(title || 'Report', 15, 38);
                
                // Add generation date
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                const date = new Date().toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                doc.text(`Generated on: ${date}`, 15, 45);
            } catch (error) {
                console.error('Error adding PDF header:', error);
            }
        }

        function addPDFFooter(doc) {
            try {
                const pageCount = doc.internal.getNumberOfPages();
                
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    
                    // Add footer line
                    doc.setDrawColor(52, 152, 219);
                    doc.line(15, 285, 195, 285);
                    
                    // Add footer text
                    doc.setTextColor(100, 100, 100);
                    doc.setFontSize(8);
                    doc.setFont('helvetica', 'normal');
                    doc.text('University of Education, Winneba - Learning Management System', 15, 290);
                    doc.text(`Page ${i} of ${pageCount}`, 170, 290);
                    doc.text(`Generated by Admin Portal - ${new Date().getFullYear()}`, 15, 294);
                }
            } catch (error) {
                console.error('Error adding PDF footer:', error);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Update statistics
            document.getElementById('totalStudents').textContent = sampleData.students.length;
            document.getElementById('totalTeachers').textContent = sampleData.teachers.length;
            document.getElementById('totalCourses').textContent = sampleData.courses.length;
            document.getElementById('totalQuizzes').textContent = sampleData.quizzes.length;
            
            // Check if PDF libraries are loaded
            console.log('jsPDF loaded:', typeof window.jspdf !== 'undefined');
            console.log('AutoTable loaded:', typeof window.jspdf?.jsPDF.API.autoTable !== 'undefined');
        });
    </script>
</body>
</html>
